!function(){var t,e,s={472:function(t,e,s){var i,n,a;a=this,i=[s(749)],void 0===(n=function(t){return a.returnExportsGlobal=function(t){return function(t){"use strict";var e={axisTitle:"",axisClass:"ct-axis-title",offset:{x:0,y:0},textAnchor:"middle",flipTitle:!1},s={axisX:e,axisY:e},i=function(t){return t instanceof Function?t():t},n=function(t){return t instanceof Function?t():t};t.plugins=t.plugins||{},t.plugins.ctAxisTitle=function(e){return e=t.extend({},s,e),function(s){s.on("created",(function(s){if(!e.axisX.axisTitle&&!e.axisY.axisTitle)throw new Error("ctAxisTitle plugin - You must provide at least one axis title");if(!s.axisX&&!s.axisY)throw new Error("ctAxisTitle plugin can only be used on charts that have at least one axis");var a,r,o,l=t.normalizePadding(s.options.chartPadding);if(e.axisX.axisTitle&&s.axisX&&(a=s.axisX.axisLength/2+s.options.axisY.offset+l.left,r=l.top,"end"===s.options.axisY.position&&(a-=s.options.axisY.offset),"end"===s.options.axisX.position&&(r+=s.axisY.axisLength),(o=new t.Svg("text")).addClass(n(e.axisX.axisClass)),o.text(i(e.axisX.axisTitle)),o.attr({x:a+e.axisX.offset.x,y:r+e.axisX.offset.y,"text-anchor":e.axisX.textAnchor}),s.svg.append(o,!0)),e.axisY.axisTitle&&s.axisY){a=0,r=s.axisY.axisLength/2+l.top,"start"===s.options.axisX.position&&(r+=s.options.axisX.offset),"end"===s.options.axisY.position&&(a=s.axisX.axisLength);var h="rotate("+(e.axisY.flipTitle?-90:90)+", "+a+", "+r+")";(o=new t.Svg("text")).addClass(n(e.axisY.axisClass)),o.text(i(e.axisY.axisTitle)),o.attr({x:a+e.axisY.offset.x,y:r+e.axisY.offset.y,transform:h,"text-anchor":e.axisY.textAnchor}),s.svg.append(o,!0)}}))}}}(t),t.plugins.ctAxisTitle}(t)}.apply(e,i))||(t.exports=n)},749:function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s={svg:"http://www.w3.org/2000/svg",xmlns:"http://www.w3.org/2000/xmlns/",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",ct:"http://gionkunz.github.com/chartist-js/ct"},i=8,n={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};function a(t,e){return"number"==typeof t?t+e:t}function r(t){if("string"==typeof t){const e=/^(\d+)\s*(.*)$/g.exec(t);return{value:e?+e[1]:0,unit:(null==e?void 0:e[2])||void 0}}return{value:Number(t)}}function o(t){return String.fromCharCode(97+t%26)}const l=2221e-19;function h(t){return Math.floor(Math.log(Math.abs(t))/Math.LN10)}function c(t,e,s){return e/s.range*t}function d(t,e){const s=Math.pow(10,e||i);return Math.round(t*s)/s}function u(t){if(1===t)return t;function e(t,s){return t%s==0?s:e(s,t%s)}function s(t){return t*t+1}let i,n=2,a=2;if(t%2==0)return 2;do{n=s(n)%t,a=s(s(a))%t,i=e(Math.abs(n-a),t)}while(1===i);return i}function m(t,e,s,i){const n=(i-90)*Math.PI/180;return{x:t+s*Math.cos(n),y:e+s*Math.sin(n)}}function p(t,e,s){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const n={high:e.high,low:e.low,valueRange:0,oom:0,step:0,min:0,max:0,range:0,numberOfSteps:0,values:[]};n.valueRange=n.high-n.low,n.oom=h(n.valueRange),n.step=Math.pow(10,n.oom),n.min=Math.floor(n.low/n.step)*n.step,n.max=Math.ceil(n.high/n.step)*n.step,n.range=n.max-n.min,n.numberOfSteps=Math.round(n.range/n.step);const a=c(t,n.step,n)<s,r=i?u(n.range):0;if(i&&c(t,1,n)>=s)n.step=1;else if(i&&r<n.step&&c(t,r,n)>=s)n.step=r;else{let e=0;for(;;){if(a&&c(t,n.step,n)<=s)n.step*=2;else{if(a||!(c(t,n.step/2,n)>=s))break;if(n.step/=2,i&&n.step%1!=0){n.step*=2;break}}if(e++>1e3)throw new Error("Exceeded maximum number of iterations while optimizing scale step!")}}function o(t,e){return t===(t+=e)&&(t*=1+(e>0?l:-l)),t}n.step=Math.max(n.step,l);let m=n.min,p=n.max;for(;m+n.step<=n.low;)m=o(m,n.step);for(;p-n.step>=n.high;)p=o(p,-n.step);n.min=m,n.max=p,n.range=n.max-n.min;const g=[];for(let t=n.min;t<=n.max;t=o(t,n.step)){const e=d(t);e!==g[g.length-1]&&g.push(e)}return n.values=g,n}function g(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};for(var e=arguments.length,s=new Array(e>1?e-1:0),i=1;i<e;i++)s[i-1]=arguments[i];for(let e=0;e<s.length;e++){const i=s[e];for(const e in i){const s=i[e];t[e]="object"!=typeof s||null===s||s instanceof Array?s:g(t[e],s)}}return t}const f=t=>t;function y(t,e){return Array.from({length:t},e?(t,s)=>e(s):()=>{})}const v=(t,e)=>t+(e||0),b=(t,e)=>y(Math.max(...t.map((t=>t.length))),(s=>e(...t.map((t=>t[s])))));function x(t,e){return null!==t&&"object"==typeof t&&Reflect.has(t,e)}function w(t){return null!==t&&isFinite(t)}function k(t){return!t&&0!==t}function E(t){return w(t)?Number(t):void 0}function S(t){return!!Array.isArray(t)&&t.every(Array.isArray)}function L(t,e){let s=0;t[arguments.length>2&&void 0!==arguments[2]&&arguments[2]?"reduceRight":"reduce"](((t,i,n)=>e(i,s++,n)),void 0)}function A(t,e){const s=Array.isArray(t)?t[e]:x(t,"data")?t.data[e]:null;return x(s,"meta")?s.meta:void 0}function C(t){return null==t||"number"==typeof t&&isNaN(t)}function M(t){return Array.isArray(t)&&t.every((t=>Array.isArray(t)||x(t,"data")))}function _(t){return"object"==typeof t&&null!==t&&(Reflect.has(t,"x")||Reflect.has(t,"y"))}function $(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"y";return _(t)&&x(t,e)?E(t[e]):E(t)}function T(t,e,s){const i={high:void 0===(e={...e,...s?"x"===s?e.axisX:e.axisY:{}}).high?-Number.MAX_VALUE:+e.high,low:void 0===e.low?Number.MAX_VALUE:+e.low},n=void 0===e.high,a=void 0===e.low;return(n||a)&&function t(e){if(!C(e))if(Array.isArray(e))for(let s=0;s<e.length;s++)t(e[s]);else{const t=Number(s&&x(e,s)?e[s]:e);n&&t>i.high&&(i.high=t),a&&t<i.low&&(i.low=t)}}(t),(e.referenceValue||0===e.referenceValue)&&(i.high=Math.max(e.referenceValue,i.high),i.low=Math.min(e.referenceValue,i.low)),i.high<=i.low&&(0===i.low?i.high=1:i.low<0?i.high=0:(i.high>0||(i.high=1),i.low=0)),i}function P(t){let e,s=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0;const a={labels:(t.labels||[]).slice(),series:N(t.series,i,n)},r=a.labels.length;return S(a.series)?(e=Math.max(r,...a.series.map((t=>t.length))),a.series.forEach((t=>{t.push(...y(Math.max(0,e-t.length)))}))):e=a.series.length,a.labels.push(...y(Math.max(0,e-r),(()=>""))),s&&function(t){var e;null===(e=t.labels)||void 0===e||e.reverse(),t.series.reverse();for(const e of t.series)x(e,"data")?e.data.reverse():Array.isArray(e)&&e.reverse()}(a),a}function I(t,e){if(!C(t))return e?function(t,e){let s,i;if("object"!=typeof t){const n=E(t);"x"===e?s=n:i=n}else x(t,"x")&&(s=E(t.x)),x(t,"y")&&(i=E(t.y));if(void 0!==s||void 0!==i)return{x:s,y:i}}(t,e):E(t)}function O(t,e){return Array.isArray(t)?t.map((t=>x(t,"value")?I(t.value,e):I(t,e))):O(t.data,e)}function N(t,e,s){if(M(t))return t.map((t=>O(t,e)));const i=O(t,e);return s?i.map((t=>[t])):i}function U(t,e,s){const i={increasingX:!1,fillHoles:!1,...s},n=[];let a=!0;for(let s=0;s<t.length;s+=2)void 0===$(e[s/2].value)?i.fillHoles||(a=!0):(i.increasingX&&s>=2&&t[s]<=t[s-2]&&(a=!0),a&&(n.push({pathCoordinates:[],valueData:[]}),a=!1),n[n.length-1].pathCoordinates.push(t[s],t[s+1]),n[n.length-1].valueData.push(e[s/2]));return n}function V(t){let e="";return null==t?t:(e="number"==typeof t?""+t:"object"==typeof t?JSON.stringify({data:t}):String(t),Object.keys(n).reduce(((t,e)=>t.replaceAll(e,n[e])),e))}class B{call(t,e){return this.svgElements.forEach((s=>Reflect.apply(s[t],s,e))),this}attr(){for(var t=arguments.length,e=new Array(t),s=0;s<t;s++)e[s]=arguments[s];return this.call("attr",e)}elem(){for(var t=arguments.length,e=new Array(t),s=0;s<t;s++)e[s]=arguments[s];return this.call("elem",e)}root(){for(var t=arguments.length,e=new Array(t),s=0;s<t;s++)e[s]=arguments[s];return this.call("root",e)}getNode(){for(var t=arguments.length,e=new Array(t),s=0;s<t;s++)e[s]=arguments[s];return this.call("getNode",e)}foreignObject(){for(var t=arguments.length,e=new Array(t),s=0;s<t;s++)e[s]=arguments[s];return this.call("foreignObject",e)}text(){for(var t=arguments.length,e=new Array(t),s=0;s<t;s++)e[s]=arguments[s];return this.call("text",e)}empty(){for(var t=arguments.length,e=new Array(t),s=0;s<t;s++)e[s]=arguments[s];return this.call("empty",e)}remove(){for(var t=arguments.length,e=new Array(t),s=0;s<t;s++)e[s]=arguments[s];return this.call("remove",e)}addClass(){for(var t=arguments.length,e=new Array(t),s=0;s<t;s++)e[s]=arguments[s];return this.call("addClass",e)}removeClass(){for(var t=arguments.length,e=new Array(t),s=0;s<t;s++)e[s]=arguments[s];return this.call("removeClass",e)}removeAllClasses(){for(var t=arguments.length,e=new Array(t),s=0;s<t;s++)e[s]=arguments[s];return this.call("removeAllClasses",e)}animate(){for(var t=arguments.length,e=new Array(t),s=0;s<t;s++)e[s]=arguments[s];return this.call("animate",e)}constructor(t){this.svgElements=[];for(let e=0;e<t.length;e++)this.svgElements.push(new z(t[e]))}}const j={easeInSine:[.47,0,.745,.715],easeOutSine:[.39,.575,.565,1],easeInOutSine:[.445,.05,.55,.95],easeInQuad:[.55,.085,.68,.53],easeOutQuad:[.25,.46,.45,.94],easeInOutQuad:[.455,.03,.515,.955],easeInCubic:[.55,.055,.675,.19],easeOutCubic:[.215,.61,.355,1],easeInOutCubic:[.645,.045,.355,1],easeInQuart:[.895,.03,.685,.22],easeOutQuart:[.165,.84,.44,1],easeInOutQuart:[.77,0,.175,1],easeInQuint:[.755,.05,.855,.06],easeOutQuint:[.23,1,.32,1],easeInOutQuint:[.86,0,.07,1],easeInExpo:[.95,.05,.795,.035],easeOutExpo:[.19,1,.22,1],easeInOutExpo:[1,0,0,1],easeInCirc:[.6,.04,.98,.335],easeOutCirc:[.075,.82,.165,1],easeInOutCirc:[.785,.135,.15,.86],easeInBack:[.6,-.28,.735,.045],easeOutBack:[.175,.885,.32,1.275],easeInOutBack:[.68,-.55,.265,1.55]};function D(t,e,s){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],n=arguments.length>4?arguments[4]:void 0;const{easing:o,...l}=s,h={};let c,d;o&&(c=Array.isArray(o)?o:j[o]),l.begin=a(l.begin,"ms"),l.dur=a(l.dur,"ms"),c&&(l.calcMode="spline",l.keySplines=c.join(" "),l.keyTimes="0;1"),i&&(l.fill="freeze",h[e]=l.from,t.attr(h),d=r(l.begin||0).value,l.begin="indefinite");const u=t.elem("animate",{attributeName:e,...l});i&&setTimeout((()=>{try{u._node.beginElement()}catch(s){h[e]=l.to,t.attr(h),u.remove()}}),d);const m=u.getNode();n&&m.addEventListener("beginEvent",(()=>n.emit("animationBegin",{element:t,animate:m,params:s}))),m.addEventListener("endEvent",(()=>{n&&n.emit("animationEnd",{element:t,animate:m,params:s}),i&&(h[e]=l.to,t.attr(h),u.remove())}))}class z{attr(t,e){return"string"==typeof t?e?this._node.getAttributeNS(e,t):this._node.getAttribute(t):(Object.keys(t).forEach((e=>{if(void 0!==t[e])if(-1!==e.indexOf(":")){const i=e.split(":");this._node.setAttributeNS(s[i[0]],e,String(t[e]))}else this._node.setAttribute(e,String(t[e]))})),this)}elem(t,e,s){return new z(t,e,s,this,arguments.length>3&&void 0!==arguments[3]&&arguments[3])}parent(){return this._node.parentNode instanceof SVGElement?new z(this._node.parentNode):null}root(){let t=this._node;for(;"svg"!==t.nodeName&&t.parentElement;)t=t.parentElement;return new z(t)}querySelector(t){const e=this._node.querySelector(t);return e?new z(e):null}querySelectorAll(t){const e=this._node.querySelectorAll(t);return new B(e)}getNode(){return this._node}foreignObject(t,e,i){let n,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if("string"==typeof t){const e=document.createElement("div");e.innerHTML=t,n=e.firstChild}else n=t;n instanceof Element&&n.setAttribute("xmlns",s.xmlns);const r=this.elem("foreignObject",e,i,a);return r._node.appendChild(n),r}text(t){return this._node.appendChild(document.createTextNode(t)),this}empty(){for(;this._node.firstChild;)this._node.removeChild(this._node.firstChild);return this}remove(){var t;return null===(t=this._node.parentNode)||void 0===t||t.removeChild(this._node),this.parent()}replace(t){var e;return null===(e=this._node.parentNode)||void 0===e||e.replaceChild(t._node,this._node),t}append(t){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]&&this._node.firstChild?this._node.insertBefore(t._node,this._node.firstChild):this._node.appendChild(t._node),this}classes(){const t=this._node.getAttribute("class");return t?t.trim().split(/\s+/):[]}addClass(t){return this._node.setAttribute("class",this.classes().concat(t.trim().split(/\s+/)).filter((function(t,e,s){return s.indexOf(t)===e})).join(" ")),this}removeClass(t){const e=t.trim().split(/\s+/);return this._node.setAttribute("class",this.classes().filter((t=>-1===e.indexOf(t))).join(" ")),this}removeAllClasses(){return this._node.setAttribute("class",""),this}height(){return this._node.getBoundingClientRect().height}width(){return this._node.getBoundingClientRect().width}animate(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],s=arguments.length>2?arguments[2]:void 0;return Object.keys(t).forEach((i=>{const n=t[i];Array.isArray(n)?n.forEach((t=>D(this,i,t,!1,s))):D(this,i,n,e,s)})),this}constructor(t,e,i,n,a=!1){t instanceof Element?this._node=t:(this._node=document.createElementNS(s.svg,t),"svg"===t&&this.attr({"xmlns:ct":s.ct})),e&&this.attr(e),i&&this.addClass(i),n&&(a&&n._node.firstChild?n._node.insertBefore(this._node,n._node.firstChild):n._node.appendChild(this._node))}}function R(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"100%",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"100%",n=arguments.length>3?arguments[3]:void 0;Array.from(t.querySelectorAll("svg")).filter((t=>t.getAttributeNS(s.xmlns,"ct"))).forEach((e=>t.removeChild(e)));const a=new z("svg").attr({width:e,height:i}).attr({style:"width: ".concat(e,"; height: ").concat(i,";")});return n&&a.addClass(n),t.appendChild(a.getNode()),a}function H(t){return"number"==typeof t?{top:t,right:t,bottom:t,left:t}:void 0===t?{top:0,right:0,bottom:0,left:0}:{top:"number"==typeof t.top?t.top:0,right:"number"==typeof t.right?t.right:0,bottom:"number"==typeof t.bottom?t.bottom:0,left:"number"==typeof t.left?t.left:0}}function q(t,e){var s,i,n,a;const o=Boolean(e.axisX||e.axisY),l=(null===(s=e.axisY)||void 0===s?void 0:s.offset)||0,h=(null===(i=e.axisX)||void 0===i?void 0:i.offset)||0,c=null===(n=e.axisY)||void 0===n?void 0:n.position,d=null===(a=e.axisX)||void 0===a?void 0:a.position;let u=t.width()||r(e.width).value||0,m=t.height()||r(e.height).value||0;const p=H(e.chartPadding);u=Math.max(u,l+p.left+p.right),m=Math.max(m,h+p.top+p.bottom);const g={x1:0,x2:0,y1:0,y2:0,padding:p,width(){return this.x2-this.x1},height(){return this.y1-this.y2}};return o?("start"===d?(g.y2=p.top+h,g.y1=Math.max(m-p.bottom,g.y2+1)):(g.y2=p.top,g.y1=Math.max(m-p.bottom-h,g.y2+1)),"start"===c?(g.x1=p.left+l,g.x2=Math.max(u-p.right,g.x1+1)):(g.x1=p.left,g.x2=Math.max(u-p.right-l,g.x1+1))):(g.x1=p.left,g.x2=Math.max(u-p.right,g.x1+1),g.y2=p.top,g.y1=Math.max(m-p.bottom,g.y2+1)),g}function X(t,e,s,i,n,a,r,o){const l={["".concat(s.units.pos,"1")]:t,["".concat(s.units.pos,"2")]:t,["".concat(s.counterUnits.pos,"1")]:i,["".concat(s.counterUnits.pos,"2")]:i+n},h=a.elem("line",l,r.join(" "));o.emit("draw",{type:"grid",axis:s,index:e,group:a,element:h,...l})}function F(t,e,s,i){const n=t.elem("rect",{x:e.x1,y:e.y2,width:e.width(),height:e.height()},s,!0);i.emit("draw",{type:"gridBackground",group:t,element:n})}function Y(t,e,s,i,n,a,r,o,l,h){const c={[n.units.pos]:t+r[n.units.pos],[n.counterUnits.pos]:r[n.counterUnits.pos],[n.units.len]:e,[n.counterUnits.len]:Math.max(0,a-10)},d=Math.round(c[n.units.len]),u=Math.round(c[n.counterUnits.len]),m=document.createElement("span");m.className=l.join(" "),m.style[n.units.len]=d+"px",m.style[n.counterUnits.len]=u+"px",m.textContent=String(i);const p=o.foreignObject(m,{style:"overflow: visible;",...c});h.emit("draw",{type:"label",axis:n,index:s,group:o,element:p,text:i,...c})}function G(t,e,s){let i;const n=[];function a(n){const a=i;i=g({},t),e&&e.forEach((t=>{window.matchMedia(t[0]).matches&&(i=g(i,t[1]))})),s&&n&&s.emit("optionsChanged",{previousOptions:a,currentOptions:i})}if(!window.matchMedia)throw new Error("window.matchMedia not found! Make sure you're using a polyfill.");return e&&e.forEach((t=>{const e=window.matchMedia(t[0]);e.addEventListener("change",a),n.push(e)})),a(),{removeMediaQueryListeners:function(){n.forEach((t=>t.removeEventListener("change",a)))},getCurrentOptions(){return i}}}z.Easing=j;const Z={m:["x","y"],l:["x","y"],c:["x1","y1","x2","y2","x","y"],a:["rx","ry","xAr","lAf","sf","x","y"]},W={accuracy:3};function Q(t,e,s,i,n,a){const r={command:n?t.toLowerCase():t.toUpperCase(),...e,...a?{data:a}:{}};s.splice(i,0,r)}function J(t,e){t.forEach(((s,i)=>{Z[s.command.toLowerCase()].forEach(((n,a)=>{e(s,n,i,a,t)}))}))}class K{static join(t){const e=new K(arguments.length>1&&void 0!==arguments[1]&&arguments[1],arguments.length>2?arguments[2]:void 0);for(let s=0;s<t.length;s++){const i=t[s];for(let t=0;t<i.pathElements.length;t++)e.pathElements.push(i.pathElements[t])}return e}position(t){return void 0!==t?(this.pos=Math.max(0,Math.min(this.pathElements.length,t)),this):this.pos}remove(t){return this.pathElements.splice(this.pos,t),this}move(t,e){let s=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3?arguments[3]:void 0;return Q("M",{x:+t,y:+e},this.pathElements,this.pos++,s,i),this}line(t,e){let s=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3?arguments[3]:void 0;return Q("L",{x:+t,y:+e},this.pathElements,this.pos++,s,i),this}curve(t,e,s,i,n,a){let r=arguments.length>6&&void 0!==arguments[6]&&arguments[6],o=arguments.length>7?arguments[7]:void 0;return Q("C",{x1:+t,y1:+e,x2:+s,y2:+i,x:+n,y:+a},this.pathElements,this.pos++,r,o),this}arc(t,e,s,i,n,a,r){let o=arguments.length>7&&void 0!==arguments[7]&&arguments[7],l=arguments.length>8?arguments[8]:void 0;return Q("A",{rx:t,ry:e,xAr:s,lAf:i,sf:n,x:a,y:r},this.pathElements,this.pos++,o,l),this}parse(t){const e=t.replace(/([A-Za-z])(-?[0-9])/g,"$1 $2").replace(/([0-9])([A-Za-z])/g,"$1 $2").split(/[\s,]+/).reduce(((t,e)=>(e.match(/[A-Za-z]/)&&t.push([]),t[t.length-1].push(e),t)),[]);"Z"===e[e.length-1][0].toUpperCase()&&e.pop();const s=e.map((t=>{const e=t.shift(),s=Z[e.toLowerCase()];return{command:e,...s.reduce(((e,s,i)=>(e[s]=+t[i],e)),{})}}));return this.pathElements.splice(this.pos,0,...s),this.pos+=s.length,this}stringify(){const t=Math.pow(10,this.options.accuracy);return this.pathElements.reduce(((e,s)=>{const i=Z[s.command.toLowerCase()].map((e=>{const i=s[e];return this.options.accuracy?Math.round(i*t)/t:i}));return e+s.command+i.join(",")}),"")+(this.close?"Z":"")}scale(t,e){return J(this.pathElements,((s,i)=>{s[i]*="x"===i[0]?t:e})),this}translate(t,e){return J(this.pathElements,((s,i)=>{s[i]+="x"===i[0]?t:e})),this}transform(t){return J(this.pathElements,((e,s,i,n,a)=>{const r=t(e,s,i,n,a);(r||0===r)&&(e[s]=r)})),this}clone(){const t=new K(arguments.length>0&&void 0!==arguments[0]&&arguments[0]||this.close);return t.pos=this.pos,t.pathElements=this.pathElements.slice().map((t=>({...t}))),t.options={...this.options},t}splitByCommand(t){const e=[new K];return this.pathElements.forEach((s=>{s.command===t.toUpperCase()&&0!==e[e.length-1].pathElements.length&&e.push(new K),e[e.length-1].pathElements.push(s)})),e}constructor(t=!1,e){this.close=t,this.pathElements=[],this.pos=0,this.options={...W,...e}}}function tt(t){const e={fillHoles:!1,...t};return function(t,s){const i=new K;let n=!0;for(let a=0;a<t.length;a+=2){const r=t[a],o=t[a+1],l=s[a/2];void 0!==$(l.value)?(n?i.move(r,o,!1,l):i.line(r,o,!1,l),n=!1):e.fillHoles||(n=!0)}return i}}function et(t){const e={fillHoles:!1,...t};return function t(s,i){const n=U(s,i,{fillHoles:e.fillHoles,increasingX:!0});if(n.length){if(n.length>1)return K.join(n.map((e=>t(e.pathCoordinates,e.valueData))));{if(s=n[0].pathCoordinates,i=n[0].valueData,s.length<=4)return tt()(s,i);const t=[],e=[],a=s.length/2,r=[],o=[],l=[],h=[];for(let i=0;i<a;i++)t[i]=s[2*i],e[i]=s[2*i+1];for(let s=0;s<a-1;s++)l[s]=e[s+1]-e[s],h[s]=t[s+1]-t[s],o[s]=l[s]/h[s];r[0]=o[0],r[a-1]=o[a-2];for(let t=1;t<a-1;t++)0===o[t]||0===o[t-1]||o[t-1]>0!=o[t]>0?r[t]=0:(r[t]=3*(h[t-1]+h[t])/((2*h[t]+h[t-1])/o[t-1]+(h[t]+2*h[t-1])/o[t]),isFinite(r[t])||(r[t]=0));const c=(new K).move(t[0],e[0],!1,i[0]);for(let s=0;s<a-1;s++)c.curve(t[s]+h[s]/3,e[s]+r[s]*h[s]/3,t[s+1]-h[s]/3,e[s+1]-r[s+1]*h[s]/3,t[s+1],e[s+1],!1,i[s+1]);return c}}return tt()([],[])}}var st=Object.freeze({__proto__:null,none:tt,simple:function(t){const e={divisor:2,fillHoles:!1,...t},s=1/Math.max(1,e.divisor);return function(t,i){const n=new K;let a,r=0,o=0;for(let l=0;l<t.length;l+=2){const h=t[l],c=t[l+1],d=(h-r)*s,u=i[l/2];void 0!==u.value?(void 0===a?n.move(h,c,!1,u):n.curve(r+d,o,h-d,c,h,c,!1,u),r=h,o=c,a=u):e.fillHoles||(r=o=0,a=void 0)}return n}},step:function(t){const e={postpone:!0,fillHoles:!1,...t};return function(t,s){const i=new K;let n,a=0,r=0;for(let o=0;o<t.length;o+=2){const l=t[o],h=t[o+1],c=s[o/2];void 0!==c.value?(void 0===n?i.move(l,h,!1,c):(e.postpone?i.line(l,r,!1,n):i.line(a,h,!1,c),i.line(l,h,!1,c)),a=l,r=h,n=c):e.fillHoles||(a=r=0,n=void 0)}return i}},cardinal:function(t){const e={tension:1,fillHoles:!1,...t},s=Math.min(1,Math.max(0,e.tension)),i=1-s;return function t(n,a){const r=U(n,a,{fillHoles:e.fillHoles});if(r.length){if(r.length>1)return K.join(r.map((e=>t(e.pathCoordinates,e.valueData))));{if(n=r[0].pathCoordinates,a=r[0].valueData,n.length<=4)return tt()(n,a);const t=(new K).move(n[0],n[1],!1,a[0]),e=!1;for(let r=0,o=n.length;o-2*Number(!e)>r;r+=2){const e=[{x:+n[r-2],y:+n[r-1]},{x:+n[r],y:+n[r+1]},{x:+n[r+2],y:+n[r+3]},{x:+n[r+4],y:+n[r+5]}];o-4===r?e[3]=e[2]:r||(e[0]={x:+n[r],y:+n[r+1]}),t.curve(s*(-e[0].x+6*e[1].x+e[2].x)/6+i*e[2].x,s*(-e[0].y+6*e[1].y+e[2].y)/6+i*e[2].y,s*(e[1].x+6*e[2].x-e[3].x)/6+i*e[2].x,s*(e[1].y+6*e[2].y-e[3].y)/6+i*e[2].y,e[2].x,e[2].y,!1,a[(r+2)/2])}return t}}return tt()([],[])}},monotoneCubic:et});class it{on(t,e){const{allListeners:s,listeners:i}=this;"*"===t?s.add(e):(i.has(t)||i.set(t,new Set),i.get(t).add(e))}off(t,e){const{allListeners:s,listeners:i}=this;if("*"===t)e?s.delete(e):s.clear();else if(i.has(t)){const s=i.get(t);e?s.delete(e):s.clear(),s.size||i.delete(t)}}emit(t,e){const{allListeners:s,listeners:i}=this;i.has(t)&&i.get(t).forEach((t=>t(e))),s.forEach((s=>s(t,e)))}constructor(){this.listeners=new Map,this.allListeners=new Set}}const nt=new WeakMap;class at{update(t,e){let s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];var i;(t&&(this.data=t||{},this.data.labels=this.data.labels||[],this.data.series=this.data.series||[],this.eventEmitter.emit("data",{type:"update",data:this.data})),e)&&(this.options=g({},s?this.options:this.defaultOptions,e),this.initializeTimeoutId||(null===(i=this.optionsProvider)||void 0===i||i.removeMediaQueryListeners(),this.optionsProvider=G(this.options,this.responsiveOptions,this.eventEmitter)));return!this.initializeTimeoutId&&this.optionsProvider&&this.createChart(this.optionsProvider.getCurrentOptions()),this}detach(){var t;this.initializeTimeoutId?window.clearTimeout(this.initializeTimeoutId):(window.removeEventListener("resize",this.resizeListener),null===(t=this.optionsProvider)||void 0===t||t.removeMediaQueryListeners());return nt.delete(this.container),this}on(t,e){return this.eventEmitter.on(t,e),this}off(t,e){return this.eventEmitter.off(t,e),this}initialize(){window.addEventListener("resize",this.resizeListener),this.optionsProvider=G(this.options,this.responsiveOptions,this.eventEmitter),this.eventEmitter.on("optionsChanged",(()=>this.update())),this.options.plugins&&this.options.plugins.forEach((t=>{Array.isArray(t)?t[0](this,t[1]):t(this)})),this.eventEmitter.emit("data",{type:"initial",data:this.data}),this.createChart(this.optionsProvider.getCurrentOptions()),this.initializeTimeoutId=null}constructor(t,e,s,i,n){this.data=e,this.defaultOptions=s,this.options=i,this.responsiveOptions=n,this.eventEmitter=new it,this.resizeListener=()=>this.update(),this.initializeTimeoutId=setTimeout((()=>this.initialize()),0);const a="string"==typeof t?document.querySelector(t):t;if(!a)throw new Error("Target element is not found");this.container=a;const r=nt.get(a);r&&r.detach(),nt.set(a,this)}}const rt={x:{pos:"x",len:"width",dir:"horizontal",rectStart:"x1",rectEnd:"x2",rectOffset:"y2"},y:{pos:"y",len:"height",dir:"vertical",rectStart:"y2",rectEnd:"y1",rectOffset:"x1"}};class ot{createGridAndLabels(t,e,s,i){const n="x"===this.units.pos?s.axisX:s.axisY,a=this.ticks.map(((t,e)=>this.projectValue(t,e))),r=this.ticks.map(n.labelInterpolationFnc);a.forEach(((o,l)=>{const h=r[l],c={x:0,y:0};let d;d=a[l+1]?a[l+1]-o:Math.max(this.axisLength-o,this.axisLength/this.ticks.length),""!==h&&k(h)||("x"===this.units.pos?(o=this.chartRect.x1+o,c.x=s.axisX.labelOffset.x,"start"===s.axisX.position?c.y=this.chartRect.padding.top+s.axisX.labelOffset.y+5:c.y=this.chartRect.y1+s.axisX.labelOffset.y+5):(o=this.chartRect.y1-o,c.y=s.axisY.labelOffset.y-d,"start"===s.axisY.position?c.x=this.chartRect.padding.left+s.axisY.labelOffset.x:c.x=this.chartRect.x2+s.axisY.labelOffset.x+10),n.showGrid&&X(o,l,this,this.gridOffset,this.chartRect[this.counterUnits.len](),t,[s.classNames.grid,s.classNames[this.units.dir]],i),n.showLabel&&Y(o,d,l,h,this,n.offset,c,e,[s.classNames.label,s.classNames[this.units.dir],"start"===n.position?s.classNames[n.position]:s.classNames.end],i))}))}constructor(t,e,s){this.units=t,this.chartRect=e,this.ticks=s,this.counterUnits=t===rt.x?rt.y:rt.x,this.axisLength=e[this.units.rectEnd]-e[this.units.rectStart],this.gridOffset=e[this.units.rectOffset]}}class lt extends ot{projectValue(t){const e=Number($(t,this.units.pos));return this.axisLength*(e-this.bounds.min)/this.bounds.range}constructor(t,e,s,i){const n=i.highLow||T(e,i,t.pos),a=p(s[t.rectEnd]-s[t.rectStart],n,i.scaleMinSpace||20,i.onlyInteger),r={min:a.min,max:a.max};super(t,s,a.values),this.bounds=a,this.range=r}}class ht extends ot{projectValue(t,e){return this.stepLength*e}constructor(t,e,s,i){const n=i.ticks||[];super(t,s,n);const a=Math.max(1,n.length-(i.stretch?1:0));this.stepLength=this.axisLength/a,this.stretch=Boolean(i.stretch)}}function ct(t,e,s){var i;if(x(t,"name")&&t.name&&(null===(i=e.series)||void 0===i?void 0:i[t.name])){const i=(null==e?void 0:e.series[t.name])[s];return void 0===i?e[s]:i}return e[s]}const dt={axisX:{offset:30,position:"end",labelOffset:{x:0,y:0},showLabel:!0,showGrid:!0,labelInterpolationFnc:f,type:void 0},axisY:{offset:40,position:"start",labelOffset:{x:0,y:0},showLabel:!0,showGrid:!0,labelInterpolationFnc:f,type:void 0,scaleMinSpace:20,onlyInteger:!1},width:void 0,height:void 0,showLine:!0,showPoint:!0,showArea:!1,areaBase:0,lineSmooth:!0,showGridBackground:!1,low:void 0,high:void 0,chartPadding:{top:15,right:15,bottom:5,left:10},fullWidth:!1,reverseData:!1,classNames:{chart:"ct-chart-line",label:"ct-label",labelGroup:"ct-labels",series:"ct-series",line:"ct-line",point:"ct-point",area:"ct-area",grid:"ct-grid",gridGroup:"ct-grids",gridBackground:"ct-grid-background",vertical:"ct-vertical",horizontal:"ct-horizontal",start:"ct-start",end:"ct-end"}};const ut={axisX:{offset:30,position:"end",labelOffset:{x:0,y:0},showLabel:!0,showGrid:!0,labelInterpolationFnc:f,scaleMinSpace:30,onlyInteger:!1},axisY:{offset:40,position:"start",labelOffset:{x:0,y:0},showLabel:!0,showGrid:!0,labelInterpolationFnc:f,scaleMinSpace:20,onlyInteger:!1},width:void 0,height:void 0,high:void 0,low:void 0,referenceValue:0,chartPadding:{top:15,right:15,bottom:5,left:10},seriesBarDistance:15,stackBars:!1,stackMode:"accumulate",horizontalBars:!1,distributeSeries:!1,reverseData:!1,showGridBackground:!1,classNames:{chart:"ct-chart-bar",horizontalBars:"ct-horizontal-bars",label:"ct-label",labelGroup:"ct-labels",series:"ct-series",bar:"ct-bar",grid:"ct-grid",gridGroup:"ct-grids",gridBackground:"ct-grid-background",vertical:"ct-vertical",horizontal:"ct-horizontal",start:"ct-start",end:"ct-end"}};const mt={width:void 0,height:void 0,chartPadding:5,classNames:{chartPie:"ct-chart-pie",chartDonut:"ct-chart-donut",series:"ct-series",slicePie:"ct-slice-pie",sliceDonut:"ct-slice-donut",label:"ct-label"},startAngle:0,total:void 0,donut:!1,donutWidth:60,showLabel:!0,labelOffset:0,labelPosition:"inside",labelInterpolationFnc:f,labelDirection:"neutral",ignoreEmptyValues:!1};function pt(t,e,s){const i=e.x>t.x;return i&&"explode"===s||!i&&"implode"===s?"start":i&&"implode"===s||!i&&"explode"===s?"end":"middle"}e.AutoScaleAxis=lt,e.Axis=ot,e.BarChart=class extends at{createChart(t){const{data:e}=this,s=P(e,t.reverseData,t.horizontalBars?"x":"y",!0),i=R(this.container,t.width,t.height,t.classNames.chart+(t.horizontalBars?" "+t.classNames.horizontalBars:"")),n=t.stackBars&&!0!==t.stackMode&&s.series.length?T([(a=s.series,b(a,(function(){for(var t=arguments.length,e=new Array(t),s=0;s<t;s++)e[s]=arguments[s];return Array.from(e).reduce(((t,e)=>({x:t.x+(x(e,"x")?e.x:0),y:t.y+(x(e,"y")?e.y:0)})),{x:0,y:0})})))],t,t.horizontalBars?"x":"y"):T(s.series,t,t.horizontalBars?"x":"y");var a;this.svg=i;const r=i.elem("g").addClass(t.classNames.gridGroup),l=i.elem("g"),h=i.elem("g").addClass(t.classNames.labelGroup);"number"==typeof t.high&&(n.high=t.high),"number"==typeof t.low&&(n.low=t.low);const c=q(i,t);let d;const u=t.distributeSeries&&t.stackBars?s.labels.slice(0,1):s.labels;let m,p,g;t.horizontalBars?(d=p=void 0===t.axisX.type?new lt(rt.x,s.series,c,{...t.axisX,highLow:n,referenceValue:0}):new t.axisX.type(rt.x,s.series,c,{...t.axisX,highLow:n,referenceValue:0}),m=g=void 0===t.axisY.type?new ht(rt.y,s.series,c,{ticks:u}):new t.axisY.type(rt.y,s.series,c,t.axisY)):(m=p=void 0===t.axisX.type?new ht(rt.x,s.series,c,{ticks:u}):new t.axisX.type(rt.x,s.series,c,t.axisX),d=g=void 0===t.axisY.type?new lt(rt.y,s.series,c,{...t.axisY,highLow:n,referenceValue:0}):new t.axisY.type(rt.y,s.series,c,{...t.axisY,highLow:n,referenceValue:0}));const f=t.horizontalBars?c.x1+d.projectValue(0):c.y1-d.projectValue(0),y="accumulate"===t.stackMode,v="accumulate-relative"===t.stackMode,k=[],E=[];let S=k;m.createGridAndLabels(r,h,t,this.eventEmitter),d.createGridAndLabels(r,h,t,this.eventEmitter),t.showGridBackground&&F(r,c,t.classNames.gridBackground,this.eventEmitter),L(e.series,((i,n)=>{const a=n-(e.series.length-1)/2;let r;r=t.distributeSeries&&!t.stackBars?m.axisLength/s.series.length/2:t.distributeSeries&&t.stackBars?m.axisLength/2:m.axisLength/s.series[n].length/2;const h=l.elem("g"),u=x(i,"name")&&i.name,b=x(i,"className")&&i.className,L=x(i,"meta")?i.meta:void 0;u&&h.attr({"ct:series-name":u}),L&&h.attr({"ct:meta":V(L)}),h.addClass([t.classNames.series,b||"".concat(t.classNames.series,"-").concat(o(n))].join(" ")),s.series[n].forEach(((e,o)=>{const l=x(e,"x")&&e.x,u=x(e,"y")&&e.y;let b,L;b=t.distributeSeries&&!t.stackBars?n:t.distributeSeries&&t.stackBars?0:o,L=t.horizontalBars?{x:c.x1+d.projectValue(l||0,o,s.series[n]),y:c.y1-m.projectValue(u||0,b,s.series[n])}:{x:c.x1+m.projectValue(l||0,b,s.series[n]),y:c.y1-d.projectValue(u||0,o,s.series[n])},m instanceof ht&&(m.stretch||(L[m.units.pos]+=r*(t.horizontalBars?-1:1)),L[m.units.pos]+=t.stackBars||t.distributeSeries?0:a*t.seriesBarDistance*(t.horizontalBars?-1:1)),v&&(S=u>=0||l>=0?k:E);const C=S[o]||f;if(S[o]=C-(f-L[m.counterUnits.pos]),void 0===e)return;const M={["".concat(m.units.pos,"1")]:L[m.units.pos],["".concat(m.units.pos,"2")]:L[m.units.pos]};t.stackBars&&(y||v||!t.stackMode)?(M["".concat(m.counterUnits.pos,"1")]=C,M["".concat(m.counterUnits.pos,"2")]=S[o]):(M["".concat(m.counterUnits.pos,"1")]=f,M["".concat(m.counterUnits.pos,"2")]=L[m.counterUnits.pos]),M.x1=Math.min(Math.max(M.x1,c.x1),c.x2),M.x2=Math.min(Math.max(M.x2,c.x1),c.x2),M.y1=Math.min(Math.max(M.y1,c.y2),c.y1),M.y2=Math.min(Math.max(M.y2,c.y2),c.y1);const _=A(i,o),$=h.elem("line",M,t.classNames.bar).attr({"ct:value":[l,u].filter(w).join(","),"ct:meta":V(_)});this.eventEmitter.emit("draw",{type:"bar",value:e,index:o,meta:_,series:i,seriesIndex:n,axisX:p,axisY:g,chartRect:c,group:h,element:$,...M})}))}),t.reverseData),this.eventEmitter.emit("created",{chartRect:c,axisX:p,axisY:g,svg:i,options:t})}constructor(t,e,s,i){super(t,e,ut,g({},ut,s),i),this.data=e}},e.BaseChart=at,e.EPSILON=l,e.EventEmitter=it,e.FixedScaleAxis=class extends ot{projectValue(t){const e=Number($(t,this.units.pos));return this.axisLength*(e-this.range.min)/(this.range.max-this.range.min)}constructor(t,e,s,i){const n=i.highLow||T(e,i,t.pos),a=i.divisor||1,r=(i.ticks||y(a,(t=>n.low+(n.high-n.low)/a*t))).sort(((t,e)=>Number(t)-Number(e))),o={min:n.low,max:n.high};super(t,s,r),this.range=o}},e.Interpolation=st,e.LineChart=class extends at{createChart(t){const{data:e}=this,s=P(e,t.reverseData,!0),i=R(this.container,t.width,t.height,t.classNames.chart);this.svg=i;const n=i.elem("g").addClass(t.classNames.gridGroup),a=i.elem("g"),r=i.elem("g").addClass(t.classNames.labelGroup),l=q(i,t);let h,c;h=void 0===t.axisX.type?new ht(rt.x,s.series,l,{...t.axisX,ticks:s.labels,stretch:t.fullWidth}):new t.axisX.type(rt.x,s.series,l,t.axisX),c=void 0===t.axisY.type?new lt(rt.y,s.series,l,{...t.axisY,high:w(t.high)?t.high:t.axisY.high,low:w(t.low)?t.low:t.axisY.low}):new t.axisY.type(rt.y,s.series,l,t.axisY),h.createGridAndLabels(n,r,t,this.eventEmitter),c.createGridAndLabels(n,r,t,this.eventEmitter),t.showGridBackground&&F(n,l,t.classNames.gridBackground,this.eventEmitter),L(e.series,((e,i)=>{const n=a.elem("g"),r=x(e,"name")&&e.name,d=x(e,"className")&&e.className,u=x(e,"meta")?e.meta:void 0;r&&n.attr({"ct:series-name":r}),u&&n.attr({"ct:meta":V(u)}),n.addClass([t.classNames.series,d||"".concat(t.classNames.series,"-").concat(o(i))].join(" "));const m=[],p=[];s.series[i].forEach(((t,n)=>{const a={x:l.x1+h.projectValue(t,n,s.series[i]),y:l.y1-c.projectValue(t,n,s.series[i])};m.push(a.x,a.y),p.push({value:t,valueIndex:n,meta:A(e,n)})}));const g={lineSmooth:ct(e,t,"lineSmooth"),showPoint:ct(e,t,"showPoint"),showLine:ct(e,t,"showLine"),showArea:ct(e,t,"showArea"),areaBase:ct(e,t,"areaBase")};let f;f="function"==typeof g.lineSmooth?g.lineSmooth:g.lineSmooth?et():tt();const y=f(m,p);if(g.showPoint&&y.pathElements.forEach((s=>{const{data:a}=s,r=n.elem("line",{x1:s.x,y1:s.y,x2:s.x+.01,y2:s.y},t.classNames.point);if(a){let t,e;x(a.value,"x")&&(t=a.value.x),x(a.value,"y")&&(e=a.value.y),r.attr({"ct:value":[t,e].filter(w).join(","),"ct:meta":V(a.meta)})}this.eventEmitter.emit("draw",{type:"point",value:null==a?void 0:a.value,index:(null==a?void 0:a.valueIndex)||0,meta:null==a?void 0:a.meta,series:e,seriesIndex:i,axisX:h,axisY:c,group:n,element:r,x:s.x,y:s.y,chartRect:l})})),g.showLine){const a=n.elem("path",{d:y.stringify()},t.classNames.line,!0);this.eventEmitter.emit("draw",{type:"line",values:s.series[i],path:y.clone(),chartRect:l,index:i,series:e,seriesIndex:i,meta:u,axisX:h,axisY:c,group:n,element:a})}if(g.showArea&&c.range){const a=Math.max(Math.min(g.areaBase,c.range.max),c.range.min),r=l.y1-c.projectValue(a);y.splitByCommand("M").filter((t=>t.pathElements.length>1)).map((t=>{const e=t.pathElements[0],s=t.pathElements[t.pathElements.length-1];return t.clone(!0).position(0).remove(1).move(e.x,r).line(e.x,e.y).position(t.pathElements.length+1).line(s.x,r)})).forEach((a=>{const r=n.elem("path",{d:a.stringify()},t.classNames.area,!0);this.eventEmitter.emit("draw",{type:"area",values:s.series[i],path:a.clone(),series:e,seriesIndex:i,axisX:h,axisY:c,chartRect:l,index:i,group:n,element:r,meta:u})}))}}),t.reverseData),this.eventEmitter.emit("created",{chartRect:l,axisX:h,axisY:c,svg:i,options:t})}constructor(t,e,s,i){super(t,e,dt,g({},dt,s),i),this.data=e}},e.PieChart=class extends at{createChart(t){const{data:e}=this,s=P(e),i=[];let n,a,l=t.startAngle;const h=R(this.container,t.width,t.height,t.donut?t.classNames.chartDonut:t.classNames.chartPie);this.svg=h;const c=q(h,t);let d=Math.min(c.width()/2,c.height()/2);const u=t.total||s.series.reduce(v,0),p=r(t.donutWidth);"%"===p.unit&&(p.value*=d/100),d-=t.donut?p.value/2:0,a="outside"===t.labelPosition||t.donut?d:"center"===t.labelPosition?0:d/2,t.labelOffset&&(a+=t.labelOffset);const g={x:c.x1+c.width()/2,y:c.y2+c.height()/2},f=1===e.series.filter((t=>x(t,"value")?0!==t.value:0!==t)).length;e.series.forEach(((t,e)=>i[e]=h.elem("g"))),t.showLabel&&(n=h.elem("g")),e.series.forEach(((r,h)=>{var y,v;if(0===s.series[h]&&t.ignoreEmptyValues)return;const b=x(r,"name")&&r.name,w=x(r,"className")&&r.className,E=x(r,"meta")?r.meta:void 0;b&&i[h].attr({"ct:series-name":b}),i[h].addClass([null===(y=t.classNames)||void 0===y?void 0:y.series,w||"".concat(null===(v=t.classNames)||void 0===v?void 0:v.series,"-").concat(o(h))].join(" "));let S=u>0?l+s.series[h]/u*360:0;const L=Math.max(0,l-(0===h||f?0:.2));S-L>=359.99&&(S=L+359.99);const A=m(g.x,g.y,d,L),C=m(g.x,g.y,d,S),M=new K(!t.donut).move(C.x,C.y).arc(d,d,0,Number(S-l>180),0,A.x,A.y);t.donut||M.line(g.x,g.y);const _=i[h].elem("path",{d:M.stringify()},t.donut?t.classNames.sliceDonut:t.classNames.slicePie);if(_.attr({"ct:value":s.series[h],"ct:meta":V(E)}),t.donut&&_.attr({style:"stroke-width: "+p.value+"px"}),this.eventEmitter.emit("draw",{type:"slice",value:s.series[h],totalDataSum:u,index:h,meta:E,series:r,group:i[h],element:_,path:M.clone(),center:g,radius:d,startAngle:l,endAngle:S,chartRect:c}),t.showLabel){let i,o;i=1===e.series.length?{x:g.x,y:g.y}:m(g.x,g.y,a,l+(S-l)/2),o=s.labels&&!k(s.labels[h])?s.labels[h]:s.series[h];const d=t.labelInterpolationFnc(o,h);if(d||0===d){const e=n.elem("text",{dx:i.x,dy:i.y,"text-anchor":pt(g,i,t.labelDirection)},t.classNames.label).text(String(d));this.eventEmitter.emit("draw",{type:"label",index:h,group:n,element:e,text:""+d,chartRect:c,series:r,meta:E,...i})}}l=S})),this.eventEmitter.emit("created",{chartRect:c,svg:h,options:t})}constructor(t,e,s,i){super(t,e,mt,g({},mt,s),i),this.data=e}},e.StepAxis=ht,e.Svg=z,e.SvgList=B,e.SvgPath=K,e.alphaNumerate=o,e.axisUnits=rt,e.createChartRect=q,e.createGrid=X,e.createGridBackground=F,e.createLabel=Y,e.createSvg=R,e.deserialize=function(t){if("string"!=typeof t)return t;if("NaN"===t)return NaN;let e=t=Object.keys(n).reduce(((t,e)=>t.replaceAll(n[e],e)),t);if("string"==typeof t)try{e=JSON.parse(t),e=void 0!==e.data?e.data:e}catch(t){}return e},e.determineAnchorPosition=pt,e.each=L,e.easings=j,e.ensureUnit=a,e.escapingMap=n,e.extend=g,e.getBounds=p,e.getHighLow=T,e.getMetaData=A,e.getMultiValue=$,e.getNumberOrUndefined=E,e.getSeriesOption=ct,e.isArrayOfArrays=S,e.isArrayOfSeries=M,e.isDataHoleValue=C,e.isFalseyButZero=k,e.isMultiValue=_,e.isNumeric=w,e.namespaces=s,e.noop=f,e.normalizeData=P,e.normalizePadding=H,e.optionsProvider=G,e.orderOfMagnitude=h,e.polarToCartesian=m,e.precision=i,e.projectLength=c,e.quantity=r,e.rho=u,e.roundWithPrecision=d,e.safeHasProperty=x,e.serialMap=b,e.serialize=V,e.splitIntoSegments=U,e.sum=v,e.times=y}},i={};function n(t){var e=i[t];if(void 0!==e)return e.exports;var a=i[t]={exports:{}};return s[t].call(a.exports,a,a.exports,n),a.exports}n.m=s,n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,{a:e}),e},n.d=function(t,e){for(var s in e)n.o(e,s)&&!n.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:e[s]})},n.f={},n.e=function(t){return Promise.all(Object.keys(n.f).reduce((function(e,s){return n.f[s](t,e),e}),[]))},n.u=function(t){return t+".bundle.js"},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},t={},e="ulogger-server:",n.l=function(s,i,a,r){if(t[s])t[s].push(i);else{var o,l;if(void 0!==a)for(var h=document.getElementsByTagName("script"),c=0;c<h.length;c++){var d=h[c];if(d.getAttribute("src")==s||d.getAttribute("data-webpack")==e+a){o=d;break}}o||(l=!0,(o=document.createElement("script")).charset="utf-8",o.timeout=120,n.nc&&o.setAttribute("nonce",n.nc),o.setAttribute("data-webpack",e+a),o.src=s),t[s]=[i];var u=function(e,i){o.onerror=o.onload=null,clearTimeout(m);var n=t[s];if(delete t[s],o.parentNode&&o.parentNode.removeChild(o),n&&n.forEach((function(t){return t(i)})),e)return e(i)},m=setTimeout(u.bind(null,void 0,{type:"timeout",target:o}),12e4);o.onerror=u.bind(null,o.onerror),o.onload=u.bind(null,o.onload),l&&document.head.appendChild(o)}},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.p="js/dist/",function(){var t={179:0};n.f.j=function(e,s){var i=n.o(t,e)?t[e]:void 0;if(0!==i)if(i)s.push(i[2]);else{var a=new Promise((function(s,n){i=t[e]=[s,n]}));s.push(i[2]=a);var r=n.p+n.u(e),o=new Error;n.l(r,(function(s){if(n.o(t,e)&&(0!==(i=t[e])&&(t[e]=void 0),i)){var a=s&&("load"===s.type?"missing":s.type),r=s&&s.target&&s.target.src;o.message="Loading chunk "+e+" failed.\n("+a+": "+r+")",o.name="ChunkLoadError",o.type=a,o.request=r,i[1](o)}}),"chunk-"+e,e)}};var e=function(e,s){var i,a,r=s[0],o=s[1],l=s[2],h=0;if(r.some((function(e){return 0!==t[e]}))){for(i in o)n.o(o,i)&&(n.m[i]=o[i]);if(l)l(n)}for(e&&e(s);h<r.length;h++)a=r[h],n.o(t,a)&&t[a]&&t[a][0](),t[a]=0},s=self.webpackChunkulogger_server=self.webpackChunkulogger_server||[];s.forEach(e.bind(null,0)),s.push=e.bind(null,s.push.bind(s))}(),function(){"use strict";class t{static post(t,e,s){const i=s||{};return i.method="POST",this.ajax(t,e,i)}static get(t,e,s){const i=s||{};return i.method="GET",this.ajax(t,e,i)}static ajax(t,e,s){const i=[];e=e||{};const n=(s=s||{}).method||"GET",a=new XMLHttpRequest;return new Promise(((s,r)=>{let o;if(a.onreadystatechange=function(){if(a.readyState!==XMLHttpRequest.DONE)return;let t="",e=!0;if(200===a.status)try{const i=JSON.parse(a.responseText);i&&(i.error?i.message&&(t=i.message):(s&&"function"==typeof s&&s(i),e=!1))}catch(e){t=e.message}else t=`HTTP error ${a.status}`;e&&r&&"function"==typeof r&&r(new Error(t))},e instanceof HTMLFormElement&&(e=new FormData(e)),e instanceof FormData)o="POST"===n?e:new URLSearchParams(e).toString();else{for(const t in e)if(e.hasOwnProperty(t))if(Array.isArray(e[t]))for(const s of e[t])i.push(`${t}[]=${this.encodeValue(s)}`);else i.push(`${t}=${this.encodeValue(e[t])}`);o=i.join("&"),o=o.replace(/%20/g,"+")}"GET"===n&&o.length&&(t+=`?${o}`,o=null),a.open(n,t,!0),"POST"!==n||e instanceof FormData||a.setRequestHeader("Content-type","application/x-www-form-urlencoded"),a.send(o)}))}static encodeValue(t){return"object"==typeof t&&(t=JSON.stringify(t)),encodeURIComponent(t)}}class e{static observe(t,e,s){if("object"!=typeof t||null===t)throw new Error("Invalid argument: invalid object");if("function"==typeof s)this.observeProperty(t,e,s);else{if("function"!=typeof e)throw new Error("Invalid argument for observe");this.observeRecursive(t,e)}}static notify(t,e){for(const s of t)(async()=>{await s(e)})()}static forceUpdate(t,e){const s=t._values[e],i=t._observers[e];this.notify(i,s)}static isObserved(t,e,s){if("object"!=typeof t||null===t||!t.hasOwnProperty(e))return!1;const i=!!(t._observers&&t._observers[e]&&t._observers[e].size>0);return i&&s?t._observers[e].has(s):i}static setSilently(t,e,s){if(!t.hasOwnProperty(e))throw new Error(`Invalid argument: object does not have property "${e}"`);if(this.isObserved(t,e)){if(t._values[e]=s,Array.isArray(t[e]))for(const s of t._observers[e])this.observeArray(t[e],s)}else t[e]=s}static observeProperty(t,s,i){if(!t.hasOwnProperty(s))throw new Error(`Invalid argument: object does not have property "${s}"`);if(this.isObserved(t,s,i))throw new Error(`Observer already registered for property ${s}`);this.addObserver(t,i,s),t.hasOwnProperty("_values")||Object.defineProperty(t,"_values",{enumerable:!1,configurable:!1,value:{}}),t._values[s]=t[s],Object.defineProperty(t,s,{get:()=>t._values[s],set:i=>{t._values[s]!==i&&(t._values[s]=i,Array.isArray(i)&&i.length&&(i[0],i.length),e.notify(t._observers[s],i)),Array.isArray(t[s])&&this.observeArray(t[s],t._observers[s])}}),Array.isArray(t[s])&&this.observeArray(t[s],i)}static observeRecursive(t,s){if(Array.isArray(t))this.observeArray(t,s);else for(const i in t)t.hasOwnProperty(i)&&e.observeProperty(t,i,s)}static observeArray(t,e){if(e instanceof Set)for(const s of e)this.addObserver(t,s);else this.addObserver(t,e);this.overrideArrayPrototypes(t,arguments)}static addObserver(t,e,s){t.hasOwnProperty("_observers")||Object.defineProperty(t,"_observers",{enumerable:!1,configurable:!1,value:3===arguments.length?[]:new Set}),3===arguments.length?(t._observers[s]||(t._observers[s]=new Set),t._observers[s].add(e)):t._observers.add(e)}static unobserve(t,e,s){if("function"==typeof s)this.unobserveProperty(t,e,s);else{if("function"!=typeof e)throw new Error("Invalid argument for unobserve");Array.isArray(t)?this.unobserveArray(t,e):this.unobserveRecursive(t,e)}}static unobserveAll(t,e){if(1===arguments.length)for(const e in t)t.hasOwnProperty(e)&&this.unobserveAll(t,e);else if(this.isObserved(t,e)){if(Array.isArray(t[e]))this.restoreArrayPrototypes(t[e]);else if("object"==typeof t[e]&&null!==t[e])for(const s in t[e])t[e].hasOwnProperty(s)&&this.unobserveAll(t[e],s);delete t._observers[e],delete t[e],t[e]=t._values[e],delete t._values[e]}}static unobserveProperty(t,e,s){Array.isArray(t[e])&&this.unobserveArray(t[e],s),this.removeObserver(t,s,e),t._observers[e].size||(delete t[e],t[e]=t._values[e],delete t._values[e])}static unobserveRecursive(t,s){for(const i in t)t.hasOwnProperty(i)&&e.unobserveProperty(t,i,s)}static unobserveArray(t,e){this.removeObserver(t,e),t._observers.size||this.restoreArrayPrototypes(t)}static overrideArrayPrototypes(t){["pop","push","reverse","shift","sort","splice","unshift"].forEach((s=>{const i=Object.getOwnPropertyDescriptor(Array.prototype,s);t.hasOwnProperty(s)||(i.value=function(){const i=Array.prototype[s].apply(t,arguments);return t.length&&(t[0],t.length),e.notify(t._observers,t),i},Object.defineProperty(t,s,i))}))}static restoreArrayPrototypes(t){["pop","push","reverse","shift","sort","splice","unshift"].forEach((e=>{delete t[e]}))}static removeObserver(t,e,s){if(!t.hasOwnProperty("_observers"))return;let i;if(3===arguments.length){if(!t._observers[s])return;i=t._observers[s]}else i=t._observers;i.forEach((t=>{t===e&&i.delete(t)}))}}class s{constructor(t,e,s){if(!(t instanceof HTMLSelectElement))throw new Error("Invalid argument for select");this.element=t,this.hasAllOption=!1,this.allText="",s&&s.length&&(this.allText=s),e&&e.length?this.head=e:(this.hasHead=!1,this.headText="")}set selected(t){this.hasValue(t)&&(this.element.value=t)}get selected(){return this.element.value}set head(t){t.length&&(this.hasHead=!0,this.headText=t,this.addHead())}get head(){return this.headText}showAllOption(t){t&&(this.allText=t),this.hasAllOption=!0;const e=this.hasHead?1:0;this.element.add(new Option(this.allText,s.allValue),e)}hideAllOption(){const t=this.selected===s.allValue;this.hasAllOption=!1,this.remove(s.allValue),t&&(this.selected=this.hasHead?s.headValue:"",this.element.dispatchEvent(new Event("change")))}addHead(){const t=new Option(this.headText,s.headValue,!0,!0);t.disabled=!0,this.element.options.add(t,0)}hasValue(t){return void 0!==this.getOption(t)}getOption(t){return[...this.element.options].find((e=>e.value===t))}remove(t){const e=this.getOption(t);e&&this.element.remove(e.index)}setOptions(t,i){i=i||this.element.value,this.element.options.length=0,this.hasHead&&this.addHead(),this.hasAllOption&&this.element.add(new Option(this.allText,s.allValue,!1,i===s.allValue));for(const s of t){const t=new Option(s.listText,s.listValue,!1,i===s.listValue);this.element.add(t),e.observe(s,"listText",(e=>{t.text=e}))}}static get allValue(){return"all"}static get headValue(){return"0"}}class i{constructor(){this.listValue=s.allValue,this.listText="-"}listItem(t,e){this.listValue=String(t),this.listText=String(e)}toString(){return`[${this.listValue}, ${this.listText}]`}}class a{static setCookie(t,e){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:30,i="";if(s){const t=new Date;t.setTime(t.getTime()+24*s*60*60*1e3),i=`; expires=${t.toUTCString()}`}document.cookie=`ulogger_${t}=${e}${i}; path=/; samesite=lax`}static sprintf(t){for(var e=arguments.length,s=new Array(e>1?e-1:0),i=1;i<e;i++)s[i-1]=arguments[i];let n=0;const a=t.replace(/%%|%s|%d/g,(t=>{if("%%"===t)return"%";if("%d"===t&&isNaN(s[n])&&void 0!==s[n])throw new Error(`Wrong format specifier ${t} for ${s[n]} argument`);if(void 0===s[n])throw new Error(`Missing argument for format specifier ${t}`);return s[n++]}));if(n<s.length)throw new Error(`Unused argument for format specifier ${t}`);return a}static addScript(t,e,s,i){if(e&&document.getElementById(e))return void(s instanceof Function&&s());const n=document.createElement("script");n.type="text/javascript",n.src=t,e&&(n.id=e),n.async=!0,s instanceof Function&&(n.onload=s),i instanceof Function&&(n.onerror=()=>i(new Error(`error loading ${e} script`))),document.getElementsByTagName("head")[0].appendChild(n)}static loadScript(t,e){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e4;const i=new Promise(((s,i)=>a.addScript(t,e,s,i))),n=this.timeoutPromise(s);return Promise.race([i,n])}static timeoutPromise(t){return new Promise(((e,s)=>{const i=setTimeout((()=>{clearTimeout(i),s(new Error(`timeout (${t} ms).`))}),t)}))}static htmlEncode(t){return t.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}static hexToRGBA(t,e){return e=void 0!==e?e:1,`rgba(${(t=t.replace("#","")).match(new RegExp(`(.{${t.length/3}})`,"g")).map((e=>parseInt(t.length%2?e+e:e,16))).concat(e).join(",")})`}static getScaleColor(t,e,s){if(s<0||s>1)throw new Error("Invalid value");const i=[];for(let n=0;n<3;n++){if(t[n]<0||t[n]>255||e[n]<0||e[n]>255)throw new Error("Invalid value");i[n]=Math.round((e[n]-t[n])*s+t[n])}return`rgb(${i[0]}, ${i[1]}, ${i[2]})`}static addCss(t,e){if(e&&document.getElementById(e))return;const s=document.createElement("link");s.type="text/css",s.rel="stylesheet",s.href=t,e&&(s.id=e),document.getElementsByTagName("head")[0].appendChild(s)}static removeElementById(t){const e=document.getElementById(t);e&&e.remove()}static nodeFromHtml(t){const e=document.createElement("template");return e.innerHTML=t.trim(),e.content.childNodes.length>1?e.content.childNodes:e.content.firstChild}static getFloat(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return a.getParsed(t,e,"float")}static getInteger(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return a.getParsed(t,e,"int")}static getString(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return a.getParsed(t,e,"string")}static getParsed(t,e,s){if(e&&null===t)return null;let i;switch(s){case"float":i=parseFloat(t);break;case"int":i=Math.round(parseFloat(t));break;case"string":i=String(t);break;default:throw new Error("Unknown type")}if(null==t||"string"!==s&&isNaN(i))throw new Error("Invalid value");return i}static getTimeString(t){let e="";return{date:`${t.getFullYear()}-${`0${t.getMonth()+1}`.slice(-2)}-${`0${t.getDate()}`.slice(-2)}`,time:t.toTimeString().replace(/^\s*([^ ]+)([^(]*)(\([^)]*\))*/,((t,s,i,n)=>(i&&(e=i.replace(/(0(?=[1-9]00))|(00\b)/g,""),n&&/[A-Z]/.test(n)&&(e+=n.match(/\b[A-Z]+/g).join(""))),s))),zone:e}}static openUrl(t){window.location.assign(t)}static deg2rad(t){return t*Math.PI/180}static isDeepEqual(t,e){return Object.keys(t).every((s=>"object"==typeof t[s]&&null!==t[s]&&"object"==typeof e[s]&&null!==e[s]?this.isDeepEqual(t[s],e[s]):t[s]===e[s]))}}class r{static fromJson(t){const e=new r;return e.id=a.getInteger(t.id),e.latitude=a.getFloat(t.latitude),e.longitude=a.getFloat(t.longitude),e.altitude=a.getInteger(t.altitude,!0),e.speed=a.getFloat(t.speed,!0),e.bearing=a.getInteger(t.bearing,!0),e.accuracy=a.getInteger(t.accuracy,!0),e.provider=a.getString(t.provider,!0),e.comment=a.getString(t.comment,!0),e.image=a.getString(t.image,!0),e.username=a.getString(t.username),e.trackname=a.getString(t.trackname),e.trackid=a.getInteger(t.trackid),e.timestamp=a.getInteger(t.timestamp),e.meters=a.getInteger(t.meters),e.seconds=a.getInteger(t.seconds),e.totalMeters=0,e.totalSeconds=0,e}hasComment(){return null!=this.comment&&this.comment.length>0}hasImage(){return null!=this.image&&this.image.length>0}hasSpeed(){return null!=this.speed}hasAltitude(){return null!=this.altitude}getImagePath(){return this.hasImage()?`uploads/${this.image}`:null}get totalSpeed(){return this.totalSeconds?this.totalMeters/this.totalSeconds:0}delete(){return r.update({action:"delete",posid:this.id})}save(){return r.update({action:"update",posid:this.id,comment:this.comment})}imageDelete(){return r.update({action:"imagedel",posid:this.id}).then((()=>{this.image=null}))}imageAdd(t){const e=new FormData;return e.append("image",t),e.append("action","imageadd"),e.append("posid",this.id),r.update(e).then((t=>{this.image=t.image}))}static update(e){return t.post("utils/handleposition.php",e)}distanceTo(t){const e=a.deg2rad(this.latitude),s=a.deg2rad(this.longitude),i=a.deg2rad(t.latitude),n=i-e,r=a.deg2rad(t.longitude)-s;return 6371e3*(2*Math.asin(Math.sqrt(Math.sin(n/2)**2+Math.cos(e)*Math.cos(i)*Math.sin(r/2)**2)))}secondsTo(t){return this.timestamp-t.timestamp}}class o extends i{constructor(){super(),this.positions=[]}clear(){this.positions.length=0}get length(){return this.positions.length}get hasPositions(){return this.positions.length>0}isLastPosition(t){return!0}isFirstPosition(t){return!0}fromJson(t){let e=[];arguments.length>1&&void 0!==arguments[1]&&arguments[1]?e=this.positions:this.clear();for(const s of t)e.push(r.fromJson(s));this.positions=e}fetchLatest(){return this.clear(),o.fetch({last:!0}).then((t=>{this.fromJson(t)}))}static fetchLatest(){const t=new o;return t.fetchLatest().then((()=>t.length?t:null))}static fetch(e){return t.get("utils/getpositions.php",e)}}class l extends o{constructor(t,e,s){if(super(),!Number.isSafeInteger(t)||t<=0||!e||!(s instanceof h))throw new Error("Invalid argument for track constructor");this.id=t,this.name=e,this.user=s,this.plotData=[],this.maxId=0,this.maxSpeed=0,this.maxAltitude=null,this.minAltitude=null,this.totalMeters=0,this.totalSeconds=0,this.listItem(t,e)}setName(t){this.name=t,this.listText=t}clear(){super.clear(),this.clearTrackCounters()}clearTrackCounters(){this.maxId=0,this.maxSpeed=0,this.maxAltitude=null,this.minAltitude=null,this.plotData.length=0,this.totalMeters=0,this.totalSeconds=0}isEqualTo(t){return!!t&&t.id===this.id}get hasPlotData(){return this.plotData.length>0}get hasAltitudes(){return null!==this.maxAltitude}get hasSpeeds(){return this.maxSpeed>0}fromJson(t){let e=[];arguments.length>1&&void 0!==arguments[1]&&arguments[1]&&this.hasPositions?e=this.positions:this.clear();for(const s of t){const t=r.fromJson(s);this.calculatePosition(t),e.push(t)}this.positions=e}isLastPosition(t){return this.length>0&&t===this.length-1}isFirstPosition(t){return this.length>0&&0===t}fetchPositions(){const t={userid:this.user.id,trackid:this.id};return this.maxId&&(t.afterid=this.maxId),o.fetch(t).then((e=>{this.fromJson(e,t.afterid>0)}))}static fetchLatest(t){return this.fetch({last:!0,userid:t.id}).then((e=>{if(e.length){const s=new l(e[0].trackid,e[0].trackname,t);return s.fromJson(e),s}return null}))}static fetchList(e){return t.get("utils/gettracks.php",{userid:e.id}).then((t=>{const s=[];for(const i of t)s.push(new l(i.id,i.name,e));return s}))}export(t){if(this.hasPositions){const e=`utils/export.php?type=${t}&userid=${this.user.id}&trackid=${this.id}`;a.openUrl(e)}}static import(e,s){return t.post("utils/import.php",e).then((t=>{const e=[];for(const i of t)e.push(new l(i.id,i.name,s));return e}))}delete(){return l.update({action:"delete",trackid:this.id})}saveMeta(){return l.update({action:"update",trackid:this.id,trackname:this.name})}static getMeta(t){return l.update({action:"getmeta",trackid:t})}static update(e){return t.post("utils/handletrack.php",e)}recalculatePositions(){this.clearTrackCounters();let t=null;for(const e of this.positions)e.meters=t?e.distanceTo(t):0,e.seconds=t?e.secondsTo(t):0,this.calculatePosition(e),t=e}calculatePosition(t){this.totalMeters+=t.meters,this.totalSeconds+=t.seconds,t.totalMeters=this.totalMeters,t.totalSeconds=this.totalSeconds,t.hasAltitude()&&(this.plotData.push({x:t.totalMeters,y:t.altitude}),(null===this.maxAltitude||t.altitude>this.maxAltitude)&&(this.maxAltitude=t.altitude),(null===this.minAltitude||t.altitude<this.minAltitude)&&(this.minAltitude=t.altitude)),t.id>this.maxId&&(this.maxId=t.id),t.hasSpeed()&&t.speed>this.maxSpeed&&(this.maxSpeed=t.speed)}}class h extends i{constructor(t,e){let s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(super(),!Number.isSafeInteger(t)||t<=0)throw new Error("Invalid argument for user constructor");this.id=t,this.login=e,this.isAdmin=s,this.listItem(t,e)}isEqualTo(t){return!!t&&t.id===this.id}fetchLastPosition(){return l.fetchLatest(this)}static fetchList(){return t.get("utils/getusers.php").then((t=>{const e=[];for(const s of t)e.push(new h(s.id,s.login,s.isAdmin));return e}))}delete(){return h.update({action:"delete",login:this.login})}static add(t,e,s){return h.update({action:"add",login:t,pass:e,admin:s}).then((e=>new h(e.id,t,s)))}static update(e){return t.post("utils/handleuser.php",e)}setPassword(e,s){return t.post("utils/changepass.php",{login:this.login,pass:e,oldpass:s})}modify(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const s={action:"update",login:this.login,admin:t};return e&&(s.pass=e),h.update(s).then((()=>{this.isAdmin=t}))}}class c{constructor(){this._isAdmin=!1,this._isAuthenticated=!1,this._user=null}set user(t){t?(this._user=t,this._isAuthenticated=!0):(this._user=null,this._isAuthenticated=!1,this._isAdmin=!1)}set isAdmin(t){if(!this._user)throw new Error("No authenticated user");this._isAdmin=t}get isAdmin(){return this._isAdmin}get isAuthenticated(){return this._isAuthenticated}get user(){return this._user}load(t){t&&t.isAuthenticated&&(this.user=new h(t.userId,t.userLogin),this.isAdmin=t.isAdmin)}}class d extends i{constructor(t,e,s,i){super(),this.id=t,this.name=e,this.url=s,this.priority=i,this.listItem(t,e)}setName(t){this.name=t,this.listItem(this.id,this.name)}setUrl(t){this.url=t}}class u extends Array{addNewLayer(t,e){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.addLayer(this.getMaxId()+1,t,e,s)}addLayer(t,e,s){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.push(new d(t,e,s,i))}delete(t){const e=this.map((t=>t.id)).indexOf(t);this.splice(e,1)}get(t){return this.find((e=>e.id===t))}getMaxId(){return Math.max(...this.map((t=>t.id)),0)}setPriorityLayer(t){for(const e of this)e.id>0&&e.id===t?e.priority=1:e.priority=0}getPriorityLayer(){for(const t of this)if(t.priority>0)return t.id;return 0}load(t){this.length=0;for(const e of t)e.id>0&&this.addLayer(e.id,e.name,e.url,e.priority)}}class m{constructor(){this.initialize()}initialize(){this.interval=10,this.units="metric",this.lang="en",this.mapApi="openlayers",this.googleKey="",this.olLayers=new u,this.initLatitude=52.23,this.initLongitude=21.01,this.requireAuth=!0,this.publicTracks=!1,this.passStrength=2,this.passLenMin=10,this.strokeWeight=2,this.strokeColor="#ff0000",this.strokeOpacity=1,this.colorNormal="#ffffff",this.colorStart="#55b500",this.colorStop="#ff6a00",this.colorExtra="#cccccc",this.colorHilite="#feff6a",this.uploadMaxSize=0,this.initUnits()}initUnits(){"imperial"===this.units?(this.factorSpeed=2.237,this.unitSpeed="unitmph",this.factorDistance=3.28,this.unitDistance="unitft",this.factorDistanceMajor=.621,this.unitDistanceMajor="unitmi"):"nautical"===this.units?(this.factorSpeed=1.944,this.unitSpeed="unitkt",this.factorDistance=1,this.unitDistance="unitm",this.factorDistanceMajor=.54,this.unitDistanceMajor="unitnm"):(this.factorSpeed=3.6,this.unitSpeed="unitkmh",this.factorDistance=1,this.unitDistance="unitm",this.factorDistanceMajor=1,this.unitDistanceMajor="unitkm"),this.unitDay="unitday",this.unitAltitude="unitamsl"}load(t){if(t){for(const e in t)"layers"===e?this.olLayers.load(t[e]):t.hasOwnProperty(e)&&this.hasOwnProperty(e)&&(this[e]=t[e]);this.initUnits()}}save(e){return this.load(e),e=Object.keys(this).filter((t=>"function"!=typeof this[t])).reduce(((t,e)=>(t[e]=this[e],t)),{}),t.post("utils/saveconfig.php",e)}reinitialize(){e.unobserveAll(this),this.initialize()}onChanged(t,s){e.observe(this,t,s)}validPassStrength(t){return this.getPassRegExp().test(t)}getPassRegExp(){let t="";return this.passStrength>0&&(t+="(?=.*[a-z])(?=.*[A-Z])"),this.passStrength>1&&(t+="(?=.*[0-9])"),this.passStrength>2&&(t+="(?=.*[^a-zA-Z0-9])"),this.passLenMin>0&&(t+=`(?=.{${this.passLenMin},})`),0===t.length&&(t=".*"),new RegExp(t)}}class p{constructor(){this.strings={},this.config=null}init(t,e){this.config=t,e&&(this.strings=e)}_(t){if(void 0===this.strings[t])throw new Error("Unknown localized string");for(var e=arguments.length,s=new Array(e>1?e-1:0),i=1;i<e;i++)s[i-1]=arguments[i];return s.length?a.sprintf(this.strings[t],...s):this.strings[t]}unit(t){const e=this.config[t];if(void 0===this.config[t])throw new Error("Unknown localized unit");return this._(e)}getLocaleSpeed(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];let s=(Math.round(t*this.config.factorSpeed*100)/100).toLocaleString(this.config.lang);return e&&(s+=` ${this.unit("unitSpeed")}`),s}getLocaleDistanceMajor(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];let s=(Math.round(t*this.config.factorDistanceMajor/10)/100).toLocaleString(this.config.lang);return e&&(s+=` ${this.unit("unitDistanceMajor")}`),s}getLocaleDistance(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];let s=(Math.round(t*this.config.factorDistance*100)/100).toLocaleString(this.config.lang);return e&&(s+=` ${this.unit("unitDistance")}`),s}getLocaleAltitude(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],s=this.getLocaleDistance(t,e);return e&&(s+=` ${this.unit("unitAltitude")}`),s.replace("-","")}getLocaleAccuracy(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.getLocaleDistance(t,e)}getLocaleDuration(t){const e=Math.floor(t/86400),s=Math.floor(t%86400/3600),i=Math.floor(t%86400%3600/60);return t=t%86400%3600%60,(e>0?`${e} ${this.unit("unitDay")} `:"")+`00${s}`.slice(-2)+":"+`00${i}`.slice(-2)+":"+`00${t}`.slice(-2)}getLocaleCoordinates(t){return`${this.coordStr(t.longitude,!0)} ${this.coordStr(t.latitude,!1)}`}coordStr(t,e){const s=Math.trunc(t),i=Math.round(100*(Math.abs(60*(t-s))+Number.EPSILON))/100;let n;return n=e?t<0?"W":"E":t<0?"S":"N",`${Math.abs(s).toLocaleString(this.config.lang)}${i.toLocaleString(this.config.lang,{maximumFractionDigits:2})}'${n}`}getLocalePassRules(){let t="";return this.config.passLenMin>0&&(t=a.sprintf(this._("passlenmin")+"\n",this.config.passLenMin)),this.config.passStrength>0&&this.config.passStrength<4&&(t+=this._(`passrules_${this.config.passStrength}`)),t}getLangList(){return this.strings.langArr||{}}}class g{constructor(){this.auth=new c,this.config=new m,this.lang=new p}initialize(){return t.get("utils/getinit.php").then((t=>{if(!(t&&t.auth&&t.config&&t.lang))throw new Error("Corrupted initialization data");this.auth.load(t.auth),this.config.load(t.config),this.lang.init(this.config,t.lang)}))}static waitForDom(){return new Promise((t=>{"complete"===document.readyState||"interactive"===document.readyState?setTimeout(t,1):document.addEventListener("DOMContentLoaded",t)}))}}const f=new g,y=f.config,v=f.lang,b=f.auth,x={svg:"http://www.w3.org/2000/svg",xmlns:"http://www.w3.org/2000/xmlns/",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",ct:"http://gionkunz.github.com/chartist-js/ct"},w=8,k={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};function E(t,e){return"number"==typeof t?t+e:t}function S(t){if("string"==typeof t){const e=/^(\d+)\s*(.*)$/g.exec(t);return{value:e?+e[1]:0,unit:(null==e?void 0:e[2])||void 0}}return{value:Number(t)}}function L(t){return String.fromCharCode(97+t%26)}const A=2221e-19;function C(t,e,s){return e/s.range*t}function M(t,e){const s=Math.pow(10,e||w);return Math.round(t*s)/s}function _(t,e,s){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const n={high:e.high,low:e.low,valueRange:0,oom:0,step:0,min:0,max:0,range:0,numberOfSteps:0,values:[]};var a;n.valueRange=n.high-n.low,n.oom=(a=n.valueRange,Math.floor(Math.log(Math.abs(a))/Math.LN10)),n.step=Math.pow(10,n.oom),n.min=Math.floor(n.low/n.step)*n.step,n.max=Math.ceil(n.high/n.step)*n.step,n.range=n.max-n.min,n.numberOfSteps=Math.round(n.range/n.step);const r=C(t,n.step,n)<s,o=i?function(t){if(1===t)return t;function e(t,s){return t%s==0?s:e(s,t%s)}function s(t){return t*t+1}let i,n=2,a=2;if(t%2==0)return 2;do{n=s(n)%t,a=s(s(a))%t,i=e(Math.abs(n-a),t)}while(1===i);return i}(n.range):0;if(i&&C(t,1,n)>=s)n.step=1;else if(i&&o<n.step&&C(t,o,n)>=s)n.step=o;else{let e=0;for(;;){if(r&&C(t,n.step,n)<=s)n.step*=2;else{if(r||!(C(t,n.step/2,n)>=s))break;if(n.step/=2,i&&n.step%1!=0){n.step*=2;break}}if(e++>1e3)throw new Error("Exceeded maximum number of iterations while optimizing scale step!")}}function l(t,e){return t===(t+=e)&&(t*=1+(e>0?A:-A)),t}n.step=Math.max(n.step,A);let h=n.min,c=n.max;for(;h+n.step<=n.low;)h=l(h,n.step);for(;c-n.step>=n.high;)c=l(c,-n.step);n.min=h,n.max=c,n.range=n.max-n.min;const d=[];for(let t=n.min;t<=n.max;t=l(t,n.step)){const e=M(t);e!==d[d.length-1]&&d.push(e)}return n.values=d,n}function $(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};for(var e=arguments.length,s=new Array(e>1?e-1:0),i=1;i<e;i++)s[i-1]=arguments[i];for(let e=0;e<s.length;e++){const i=s[e];for(const e in i){const s=i[e];t[e]="object"!=typeof s||null===s||s instanceof Array?s:$(t[e],s)}}return t}const T=t=>t;function P(t,e){return Array.from({length:t},e?(t,s)=>e(s):()=>{})}function I(t,e){return null!==t&&"object"==typeof t&&Reflect.has(t,e)}function O(t){return null!==t&&isFinite(t)}function N(t){return!t&&0!==t}function U(t){return O(t)?Number(t):void 0}function V(t,e){let s=0;t[arguments.length>2&&void 0!==arguments[2]&&arguments[2]?"reduceRight":"reduce"](((t,i,n)=>e(i,s++,n)),void 0)}function B(t,e){const s=Array.isArray(t)?t[e]:I(t,"data")?t.data[e]:null;return I(s,"meta")?s.meta:void 0}function j(t){return null==t||"number"==typeof t&&isNaN(t)}function D(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"y";return function(t){return"object"==typeof t&&null!==t&&(Reflect.has(t,"x")||Reflect.has(t,"y"))}(t)&&I(t,e)?U(t[e]):U(t)}function z(t,e,s){const i={high:void 0===(e={...e,...s?"x"===s?e.axisX:e.axisY:{}}).high?-Number.MAX_VALUE:+e.high,low:void 0===e.low?Number.MAX_VALUE:+e.low},n=void 0===e.high,a=void 0===e.low;return(n||a)&&function t(e){if(!j(e))if(Array.isArray(e))for(let s=0;s<e.length;s++)t(e[s]);else{const t=Number(s&&I(e,s)?e[s]:e);n&&t>i.high&&(i.high=t),a&&t<i.low&&(i.low=t)}}(t),(e.referenceValue||0===e.referenceValue)&&(i.high=Math.max(e.referenceValue,i.high),i.low=Math.min(e.referenceValue,i.low)),i.high<=i.low&&(0===i.low?i.high=1:i.low<0?i.high=0:(i.high>0||(i.high=1),i.low=0)),i}function R(t){let e,s=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0;const a={labels:(t.labels||[]).slice(),series:X(t.series,i,n)},r=a.labels.length;return!function(t){return!!Array.isArray(t)&&t.every(Array.isArray)}(a.series)?e=a.series.length:(e=Math.max(r,...a.series.map((t=>t.length))),a.series.forEach((t=>{t.push(...P(Math.max(0,e-t.length)))}))),a.labels.push(...P(Math.max(0,e-r),(()=>""))),s&&function(t){var e;null===(e=t.labels)||void 0===e||e.reverse(),t.series.reverse();for(const e of t.series)I(e,"data")?e.data.reverse():Array.isArray(e)&&e.reverse()}(a),a}function H(t,e){if(!j(t))return e?function(t,e){let s,i;if("object"!=typeof t){const n=U(t);"x"===e?s=n:i=n}else I(t,"x")&&(s=U(t.x)),I(t,"y")&&(i=U(t.y));if(void 0!==s||void 0!==i)return{x:s,y:i}}(t,e):U(t)}function q(t,e){return Array.isArray(t)?t.map((t=>I(t,"value")?H(t.value,e):H(t,e))):q(t.data,e)}function X(t,e,s){if(i=t,Array.isArray(i)&&i.every((t=>Array.isArray(t)||I(t,"data"))))return t.map((t=>q(t,e)));var i;const n=q(t,e);return s?n.map((t=>[t])):n}function F(t,e,s){const i={increasingX:!1,fillHoles:!1,...s},n=[];let a=!0;for(let s=0;s<t.length;s+=2)void 0===D(e[s/2].value)?i.fillHoles||(a=!0):(i.increasingX&&s>=2&&t[s]<=t[s-2]&&(a=!0),a&&(n.push({pathCoordinates:[],valueData:[]}),a=!1),n[n.length-1].pathCoordinates.push(t[s],t[s+1]),n[n.length-1].valueData.push(e[s/2]));return n}function Y(t){let e="";return null==t?t:(e="number"==typeof t?""+t:"object"==typeof t?JSON.stringify({data:t}):String(t),Object.keys(k).reduce(((t,e)=>t.replaceAll(e,k[e])),e))}class G{call(t,e){return this.svgElements.forEach((s=>Reflect.apply(s[t],s,e))),this}attr(){for(var t=arguments.length,e=new Array(t),s=0;s<t;s++)e[s]=arguments[s];return this.call("attr",e)}elem(){for(var t=arguments.length,e=new Array(t),s=0;s<t;s++)e[s]=arguments[s];return this.call("elem",e)}root(){for(var t=arguments.length,e=new Array(t),s=0;s<t;s++)e[s]=arguments[s];return this.call("root",e)}getNode(){for(var t=arguments.length,e=new Array(t),s=0;s<t;s++)e[s]=arguments[s];return this.call("getNode",e)}foreignObject(){for(var t=arguments.length,e=new Array(t),s=0;s<t;s++)e[s]=arguments[s];return this.call("foreignObject",e)}text(){for(var t=arguments.length,e=new Array(t),s=0;s<t;s++)e[s]=arguments[s];return this.call("text",e)}empty(){for(var t=arguments.length,e=new Array(t),s=0;s<t;s++)e[s]=arguments[s];return this.call("empty",e)}remove(){for(var t=arguments.length,e=new Array(t),s=0;s<t;s++)e[s]=arguments[s];return this.call("remove",e)}addClass(){for(var t=arguments.length,e=new Array(t),s=0;s<t;s++)e[s]=arguments[s];return this.call("addClass",e)}removeClass(){for(var t=arguments.length,e=new Array(t),s=0;s<t;s++)e[s]=arguments[s];return this.call("removeClass",e)}removeAllClasses(){for(var t=arguments.length,e=new Array(t),s=0;s<t;s++)e[s]=arguments[s];return this.call("removeAllClasses",e)}animate(){for(var t=arguments.length,e=new Array(t),s=0;s<t;s++)e[s]=arguments[s];return this.call("animate",e)}constructor(t){this.svgElements=[];for(let e=0;e<t.length;e++)this.svgElements.push(new Q(t[e]))}}const Z={easeInSine:[.47,0,.745,.715],easeOutSine:[.39,.575,.565,1],easeInOutSine:[.445,.05,.55,.95],easeInQuad:[.55,.085,.68,.53],easeOutQuad:[.25,.46,.45,.94],easeInOutQuad:[.455,.03,.515,.955],easeInCubic:[.55,.055,.675,.19],easeOutCubic:[.215,.61,.355,1],easeInOutCubic:[.645,.045,.355,1],easeInQuart:[.895,.03,.685,.22],easeOutQuart:[.165,.84,.44,1],easeInOutQuart:[.77,0,.175,1],easeInQuint:[.755,.05,.855,.06],easeOutQuint:[.23,1,.32,1],easeInOutQuint:[.86,0,.07,1],easeInExpo:[.95,.05,.795,.035],easeOutExpo:[.19,1,.22,1],easeInOutExpo:[1,0,0,1],easeInCirc:[.6,.04,.98,.335],easeOutCirc:[.075,.82,.165,1],easeInOutCirc:[.785,.135,.15,.86],easeInBack:[.6,-.28,.735,.045],easeOutBack:[.175,.885,.32,1.275],easeInOutBack:[.68,-.55,.265,1.55]};function W(t,e,s){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],n=arguments.length>4?arguments[4]:void 0;const{easing:a,...r}=s,o={};let l,h;a&&(l=Array.isArray(a)?a:Z[a]),r.begin=E(r.begin,"ms"),r.dur=E(r.dur,"ms"),l&&(r.calcMode="spline",r.keySplines=l.join(" "),r.keyTimes="0;1"),i&&(r.fill="freeze",o[e]=r.from,t.attr(o),h=S(r.begin||0).value,r.begin="indefinite");const c=t.elem("animate",{attributeName:e,...r});i&&setTimeout((()=>{try{c._node.beginElement()}catch(s){o[e]=r.to,t.attr(o),c.remove()}}),h);const d=c.getNode();n&&d.addEventListener("beginEvent",(()=>n.emit("animationBegin",{element:t,animate:d,params:s}))),d.addEventListener("endEvent",(()=>{n&&n.emit("animationEnd",{element:t,animate:d,params:s}),i&&(o[e]=r.to,t.attr(o),c.remove())}))}class Q{attr(t,e){return"string"==typeof t?e?this._node.getAttributeNS(e,t):this._node.getAttribute(t):(Object.keys(t).forEach((e=>{if(void 0!==t[e])if(-1!==e.indexOf(":")){const s=e.split(":");this._node.setAttributeNS(x[s[0]],e,String(t[e]))}else this._node.setAttribute(e,String(t[e]))})),this)}elem(t,e,s){return new Q(t,e,s,this,arguments.length>3&&void 0!==arguments[3]&&arguments[3])}parent(){return this._node.parentNode instanceof SVGElement?new Q(this._node.parentNode):null}root(){let t=this._node;for(;"svg"!==t.nodeName&&t.parentElement;)t=t.parentElement;return new Q(t)}querySelector(t){const e=this._node.querySelector(t);return e?new Q(e):null}querySelectorAll(t){const e=this._node.querySelectorAll(t);return new G(e)}getNode(){return this._node}foreignObject(t,e,s){let i,n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if("string"==typeof t){const e=document.createElement("div");e.innerHTML=t,i=e.firstChild}else i=t;i instanceof Element&&i.setAttribute("xmlns",x.xmlns);const a=this.elem("foreignObject",e,s,n);return a._node.appendChild(i),a}text(t){return this._node.appendChild(document.createTextNode(t)),this}empty(){for(;this._node.firstChild;)this._node.removeChild(this._node.firstChild);return this}remove(){var t;return null===(t=this._node.parentNode)||void 0===t||t.removeChild(this._node),this.parent()}replace(t){var e;return null===(e=this._node.parentNode)||void 0===e||e.replaceChild(t._node,this._node),t}append(t){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]&&this._node.firstChild?this._node.insertBefore(t._node,this._node.firstChild):this._node.appendChild(t._node),this}classes(){const t=this._node.getAttribute("class");return t?t.trim().split(/\s+/):[]}addClass(t){return this._node.setAttribute("class",this.classes().concat(t.trim().split(/\s+/)).filter((function(t,e,s){return s.indexOf(t)===e})).join(" ")),this}removeClass(t){const e=t.trim().split(/\s+/);return this._node.setAttribute("class",this.classes().filter((t=>-1===e.indexOf(t))).join(" ")),this}removeAllClasses(){return this._node.setAttribute("class",""),this}height(){return this._node.getBoundingClientRect().height}width(){return this._node.getBoundingClientRect().width}animate(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],s=arguments.length>2?arguments[2]:void 0;return Object.keys(t).forEach((i=>{const n=t[i];Array.isArray(n)?n.forEach((t=>W(this,i,t,!1,s))):W(this,i,n,e,s)})),this}constructor(t,e,s,i){let n=arguments.length>4&&void 0!==arguments[4]&&arguments[4];t instanceof Element?this._node=t:(this._node=document.createElementNS(x.svg,t),"svg"===t&&this.attr({"xmlns:ct":x.ct})),e&&this.attr(e),s&&this.addClass(s),i&&(n&&i._node.firstChild?i._node.insertBefore(this._node,i._node.firstChild):i._node.appendChild(this._node))}}function J(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"100%",s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"100%",i=arguments.length>3?arguments[3]:void 0;Array.from(t.querySelectorAll("svg")).filter((t=>t.getAttributeNS(x.xmlns,"ct"))).forEach((e=>t.removeChild(e)));const n=new Q("svg").attr({width:e,height:s}).attr({style:"width: ".concat(e,"; height: ").concat(s,";")});return i&&n.addClass(i),t.appendChild(n.getNode()),n}function K(t,e){var s,i,n,a;const r=Boolean(e.axisX||e.axisY),o=(null===(s=e.axisY)||void 0===s?void 0:s.offset)||0,l=(null===(i=e.axisX)||void 0===i?void 0:i.offset)||0,h=null===(n=e.axisY)||void 0===n?void 0:n.position,c=null===(a=e.axisX)||void 0===a?void 0:a.position;let d=t.width()||S(e.width).value||0,u=t.height()||S(e.height).value||0;const m="number"==typeof(p=e.chartPadding)?{top:p,right:p,bottom:p,left:p}:void 0===p?{top:0,right:0,bottom:0,left:0}:{top:"number"==typeof p.top?p.top:0,right:"number"==typeof p.right?p.right:0,bottom:"number"==typeof p.bottom?p.bottom:0,left:"number"==typeof p.left?p.left:0};var p;d=Math.max(d,o+m.left+m.right),u=Math.max(u,l+m.top+m.bottom);const g={x1:0,x2:0,y1:0,y2:0,padding:m,width(){return this.x2-this.x1},height(){return this.y1-this.y2}};return r?("start"===c?(g.y2=m.top+l,g.y1=Math.max(u-m.bottom,g.y2+1)):(g.y2=m.top,g.y1=Math.max(u-m.bottom-l,g.y2+1)),"start"===h?(g.x1=m.left+o,g.x2=Math.max(d-m.right,g.x1+1)):(g.x1=m.left,g.x2=Math.max(d-m.right-o,g.x1+1))):(g.x1=m.left,g.x2=Math.max(d-m.right,g.x1+1),g.y2=m.top,g.y1=Math.max(u-m.bottom,g.y2+1)),g}function tt(t,e,s,i){const n=t.elem("rect",{x:e.x1,y:e.y2,width:e.width(),height:e.height()},s,!0);i.emit("draw",{type:"gridBackground",group:t,element:n})}function et(t,e,s){let i;const n=[];function a(n){const a=i;i=$({},t),e&&e.forEach((t=>{window.matchMedia(t[0]).matches&&(i=$(i,t[1]))})),s&&n&&s.emit("optionsChanged",{previousOptions:a,currentOptions:i})}if(!window.matchMedia)throw new Error("window.matchMedia not found! Make sure you're using a polyfill.");return e&&e.forEach((t=>{const e=window.matchMedia(t[0]);e.addEventListener("change",a),n.push(e)})),a(),{removeMediaQueryListeners:function(){n.forEach((t=>t.removeEventListener("change",a)))},getCurrentOptions(){return i}}}Q.Easing=Z;const st={m:["x","y"],l:["x","y"],c:["x1","y1","x2","y2","x","y"],a:["rx","ry","xAr","lAf","sf","x","y"]},it={accuracy:3};function nt(t,e,s,i,n,a){const r={command:n?t.toLowerCase():t.toUpperCase(),...e,...a?{data:a}:{}};s.splice(i,0,r)}function at(t,e){t.forEach(((s,i)=>{st[s.command.toLowerCase()].forEach(((n,a)=>{e(s,n,i,a,t)}))}))}class rt{static join(t){const e=new rt(arguments.length>1&&void 0!==arguments[1]&&arguments[1],arguments.length>2?arguments[2]:void 0);for(let s=0;s<t.length;s++){const i=t[s];for(let t=0;t<i.pathElements.length;t++)e.pathElements.push(i.pathElements[t])}return e}position(t){return void 0!==t?(this.pos=Math.max(0,Math.min(this.pathElements.length,t)),this):this.pos}remove(t){return this.pathElements.splice(this.pos,t),this}move(t,e){let s=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3?arguments[3]:void 0;return nt("M",{x:+t,y:+e},this.pathElements,this.pos++,s,i),this}line(t,e){let s=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3?arguments[3]:void 0;return nt("L",{x:+t,y:+e},this.pathElements,this.pos++,s,i),this}curve(t,e,s,i,n,a){let r=arguments.length>6&&void 0!==arguments[6]&&arguments[6],o=arguments.length>7?arguments[7]:void 0;return nt("C",{x1:+t,y1:+e,x2:+s,y2:+i,x:+n,y:+a},this.pathElements,this.pos++,r,o),this}arc(t,e,s,i,n,a,r){let o=arguments.length>7&&void 0!==arguments[7]&&arguments[7],l=arguments.length>8?arguments[8]:void 0;return nt("A",{rx:t,ry:e,xAr:s,lAf:i,sf:n,x:a,y:r},this.pathElements,this.pos++,o,l),this}parse(t){const e=t.replace(/([A-Za-z])(-?[0-9])/g,"$1 $2").replace(/([0-9])([A-Za-z])/g,"$1 $2").split(/[\s,]+/).reduce(((t,e)=>(e.match(/[A-Za-z]/)&&t.push([]),t[t.length-1].push(e),t)),[]);"Z"===e[e.length-1][0].toUpperCase()&&e.pop();const s=e.map((t=>{const e=t.shift(),s=st[e.toLowerCase()];return{command:e,...s.reduce(((e,s,i)=>(e[s]=+t[i],e)),{})}}));return this.pathElements.splice(this.pos,0,...s),this.pos+=s.length,this}stringify(){const t=Math.pow(10,this.options.accuracy);return this.pathElements.reduce(((e,s)=>{const i=st[s.command.toLowerCase()].map((e=>{const i=s[e];return this.options.accuracy?Math.round(i*t)/t:i}));return e+s.command+i.join(",")}),"")+(this.close?"Z":"")}scale(t,e){return at(this.pathElements,((s,i)=>{s[i]*="x"===i[0]?t:e})),this}translate(t,e){return at(this.pathElements,((s,i)=>{s[i]+="x"===i[0]?t:e})),this}transform(t){return at(this.pathElements,((e,s,i,n,a)=>{const r=t(e,s,i,n,a);(r||0===r)&&(e[s]=r)})),this}clone(){const t=new rt(arguments.length>0&&void 0!==arguments[0]&&arguments[0]||this.close);return t.pos=this.pos,t.pathElements=this.pathElements.slice().map((t=>({...t}))),t.options={...this.options},t}splitByCommand(t){const e=[new rt];return this.pathElements.forEach((s=>{s.command===t.toUpperCase()&&0!==e[e.length-1].pathElements.length&&e.push(new rt),e[e.length-1].pathElements.push(s)})),e}constructor(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=arguments.length>1?arguments[1]:void 0;this.close=t,this.pathElements=[],this.pos=0,this.options={...it,...e}}}function ot(t){const e={fillHoles:!1,...t};return function(t,s){const i=new rt;let n=!0;for(let a=0;a<t.length;a+=2){const r=t[a],o=t[a+1],l=s[a/2];void 0!==D(l.value)?(n?i.move(r,o,!1,l):i.line(r,o,!1,l),n=!1):e.fillHoles||(n=!0)}return i}}function lt(t){const e={fillHoles:!1,...t};return function t(s,i){const n=F(s,i,{fillHoles:e.fillHoles,increasingX:!0});if(n.length){if(n.length>1)return rt.join(n.map((e=>t(e.pathCoordinates,e.valueData))));{if(s=n[0].pathCoordinates,i=n[0].valueData,s.length<=4)return ot()(s,i);const t=[],e=[],a=s.length/2,r=[],o=[],l=[],h=[];for(let i=0;i<a;i++)t[i]=s[2*i],e[i]=s[2*i+1];for(let s=0;s<a-1;s++)l[s]=e[s+1]-e[s],h[s]=t[s+1]-t[s],o[s]=l[s]/h[s];r[0]=o[0],r[a-1]=o[a-2];for(let t=1;t<a-1;t++)0===o[t]||0===o[t-1]||o[t-1]>0!=o[t]>0?r[t]=0:(r[t]=3*(h[t-1]+h[t])/((2*h[t]+h[t-1])/o[t-1]+(h[t]+2*h[t-1])/o[t]),isFinite(r[t])||(r[t]=0));const c=(new rt).move(t[0],e[0],!1,i[0]);for(let s=0;s<a-1;s++)c.curve(t[s]+h[s]/3,e[s]+r[s]*h[s]/3,t[s+1]-h[s]/3,e[s+1]-r[s+1]*h[s]/3,t[s+1],e[s+1],!1,i[s+1]);return c}}return ot()([],[])}}class ht{on(t,e){const{allListeners:s,listeners:i}=this;"*"===t?s.add(e):(i.has(t)||i.set(t,new Set),i.get(t).add(e))}off(t,e){const{allListeners:s,listeners:i}=this;if("*"===t)e?s.delete(e):s.clear();else if(i.has(t)){const s=i.get(t);e?s.delete(e):s.clear(),s.size||i.delete(t)}}emit(t,e){const{allListeners:s,listeners:i}=this;i.has(t)&&i.get(t).forEach((t=>t(e))),s.forEach((s=>s(t,e)))}constructor(){this.listeners=new Map,this.allListeners=new Set}}const ct=new WeakMap;class dt{update(t,e){let s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];var i;(t&&(this.data=t||{},this.data.labels=this.data.labels||[],this.data.series=this.data.series||[],this.eventEmitter.emit("data",{type:"update",data:this.data})),e)&&(this.options=$({},s?this.options:this.defaultOptions,e),this.initializeTimeoutId||(null===(i=this.optionsProvider)||void 0===i||i.removeMediaQueryListeners(),this.optionsProvider=et(this.options,this.responsiveOptions,this.eventEmitter)));return!this.initializeTimeoutId&&this.optionsProvider&&this.createChart(this.optionsProvider.getCurrentOptions()),this}detach(){var t;this.initializeTimeoutId?window.clearTimeout(this.initializeTimeoutId):(window.removeEventListener("resize",this.resizeListener),null===(t=this.optionsProvider)||void 0===t||t.removeMediaQueryListeners());return ct.delete(this.container),this}on(t,e){return this.eventEmitter.on(t,e),this}off(t,e){return this.eventEmitter.off(t,e),this}initialize(){window.addEventListener("resize",this.resizeListener),this.optionsProvider=et(this.options,this.responsiveOptions,this.eventEmitter),this.eventEmitter.on("optionsChanged",(()=>this.update())),this.options.plugins&&this.options.plugins.forEach((t=>{Array.isArray(t)?t[0](this,t[1]):t(this)})),this.eventEmitter.emit("data",{type:"initial",data:this.data}),this.createChart(this.optionsProvider.getCurrentOptions()),this.initializeTimeoutId=null}constructor(t,e,s,i,n){this.data=e,this.defaultOptions=s,this.options=i,this.responsiveOptions=n,this.eventEmitter=new ht,this.resizeListener=()=>this.update(),this.initializeTimeoutId=setTimeout((()=>this.initialize()),0);const a="string"==typeof t?document.querySelector(t):t;if(!a)throw new Error("Target element is not found");this.container=a;const r=ct.get(a);r&&r.detach(),ct.set(a,this)}}const ut={x:{pos:"x",len:"width",dir:"horizontal",rectStart:"x1",rectEnd:"x2",rectOffset:"y2"},y:{pos:"y",len:"height",dir:"vertical",rectStart:"y2",rectEnd:"y1",rectOffset:"x1"}};class mt{createGridAndLabels(t,e,s,i){const n="x"===this.units.pos?s.axisX:s.axisY,a=this.ticks.map(((t,e)=>this.projectValue(t,e))),r=this.ticks.map(n.labelInterpolationFnc);a.forEach(((o,l)=>{const h=r[l],c={x:0,y:0};let d;d=a[l+1]?a[l+1]-o:Math.max(this.axisLength-o,this.axisLength/this.ticks.length),""!==h&&N(h)||("x"===this.units.pos?(o=this.chartRect.x1+o,c.x=s.axisX.labelOffset.x,"start"===s.axisX.position?c.y=this.chartRect.padding.top+s.axisX.labelOffset.y+5:c.y=this.chartRect.y1+s.axisX.labelOffset.y+5):(o=this.chartRect.y1-o,c.y=s.axisY.labelOffset.y-d,"start"===s.axisY.position?c.x=this.chartRect.padding.left+s.axisY.labelOffset.x:c.x=this.chartRect.x2+s.axisY.labelOffset.x+10),n.showGrid&&function(t,e,s,i,n,a,r,o){const l={["".concat(s.units.pos,"1")]:t,["".concat(s.units.pos,"2")]:t,["".concat(s.counterUnits.pos,"1")]:i,["".concat(s.counterUnits.pos,"2")]:i+n},h=a.elem("line",l,r.join(" "));o.emit("draw",{type:"grid",axis:s,index:e,group:a,element:h,...l})}(o,l,this,this.gridOffset,this.chartRect[this.counterUnits.len](),t,[s.classNames.grid,s.classNames[this.units.dir]],i),n.showLabel&&function(t,e,s,i,n,a,r,o,l,h){const c={[n.units.pos]:t+r[n.units.pos],[n.counterUnits.pos]:r[n.counterUnits.pos],[n.units.len]:e,[n.counterUnits.len]:Math.max(0,a-10)},d=Math.round(c[n.units.len]),u=Math.round(c[n.counterUnits.len]),m=document.createElement("span");m.className=l.join(" "),m.style[n.units.len]=d+"px",m.style[n.counterUnits.len]=u+"px",m.textContent=String(i);const p=o.foreignObject(m,{style:"overflow: visible;",...c});h.emit("draw",{type:"label",axis:n,index:s,group:o,element:p,text:i,...c})}(o,d,l,h,this,n.offset,c,e,[s.classNames.label,s.classNames[this.units.dir],"start"===n.position?s.classNames[n.position]:s.classNames.end],i))}))}constructor(t,e,s){this.units=t,this.chartRect=e,this.ticks=s,this.counterUnits=t===ut.x?ut.y:ut.x,this.axisLength=e[this.units.rectEnd]-e[this.units.rectStart],this.gridOffset=e[this.units.rectOffset]}}class pt extends mt{projectValue(t){const e=Number(D(t,this.units.pos));return this.axisLength*(e-this.bounds.min)/this.bounds.range}constructor(t,e,s,i){const n=i.highLow||z(e,i,t.pos),a=_(s[t.rectEnd]-s[t.rectStart],n,i.scaleMinSpace||20,i.onlyInteger),r={min:a.min,max:a.max};super(t,s,a.values),this.bounds=a,this.range=r}}class gt extends mt{projectValue(t,e){return this.stepLength*e}constructor(t,e,s,i){const n=i.ticks||[];super(t,s,n);const a=Math.max(1,n.length-(i.stretch?1:0));this.stepLength=this.axisLength/a,this.stretch=Boolean(i.stretch)}}function ft(t,e,s){var i;if(I(t,"name")&&t.name&&(null===(i=e.series)||void 0===i?void 0:i[t.name])){const i=(null==e?void 0:e.series[t.name])[s];return void 0===i?e[s]:i}return e[s]}const yt={axisX:{offset:30,position:"end",labelOffset:{x:0,y:0},showLabel:!0,showGrid:!0,labelInterpolationFnc:T,type:void 0},axisY:{offset:40,position:"start",labelOffset:{x:0,y:0},showLabel:!0,showGrid:!0,labelInterpolationFnc:T,type:void 0,scaleMinSpace:20,onlyInteger:!1},width:void 0,height:void 0,showLine:!0,showPoint:!0,showArea:!1,areaBase:0,lineSmooth:!0,showGridBackground:!1,low:void 0,high:void 0,chartPadding:{top:15,right:15,bottom:5,left:10},fullWidth:!1,reverseData:!1,classNames:{chart:"ct-chart-line",label:"ct-label",labelGroup:"ct-labels",series:"ct-series",line:"ct-line",point:"ct-point",area:"ct-area",grid:"ct-grid",gridGroup:"ct-grids",gridBackground:"ct-grid-background",vertical:"ct-vertical",horizontal:"ct-horizontal",start:"ct-start",end:"ct-end"}};class vt extends dt{createChart(t){const{data:e}=this,s=R(e,t.reverseData,!0),i=J(this.container,t.width,t.height,t.classNames.chart);this.svg=i;const n=i.elem("g").addClass(t.classNames.gridGroup),a=i.elem("g"),r=i.elem("g").addClass(t.classNames.labelGroup),o=K(i,t);let l,h;l=void 0===t.axisX.type?new gt(ut.x,s.series,o,{...t.axisX,ticks:s.labels,stretch:t.fullWidth}):new t.axisX.type(ut.x,s.series,o,t.axisX),h=void 0===t.axisY.type?new pt(ut.y,s.series,o,{...t.axisY,high:O(t.high)?t.high:t.axisY.high,low:O(t.low)?t.low:t.axisY.low}):new t.axisY.type(ut.y,s.series,o,t.axisY),l.createGridAndLabels(n,r,t,this.eventEmitter),h.createGridAndLabels(n,r,t,this.eventEmitter),t.showGridBackground&&tt(n,o,t.classNames.gridBackground,this.eventEmitter),V(e.series,((e,i)=>{const n=a.elem("g"),r=I(e,"name")&&e.name,c=I(e,"className")&&e.className,d=I(e,"meta")?e.meta:void 0;r&&n.attr({"ct:series-name":r}),d&&n.attr({"ct:meta":Y(d)}),n.addClass([t.classNames.series,c||"".concat(t.classNames.series,"-").concat(L(i))].join(" "));const u=[],m=[];s.series[i].forEach(((t,n)=>{const a={x:o.x1+l.projectValue(t,n,s.series[i]),y:o.y1-h.projectValue(t,n,s.series[i])};u.push(a.x,a.y),m.push({value:t,valueIndex:n,meta:B(e,n)})}));const p={lineSmooth:ft(e,t,"lineSmooth"),showPoint:ft(e,t,"showPoint"),showLine:ft(e,t,"showLine"),showArea:ft(e,t,"showArea"),areaBase:ft(e,t,"areaBase")};let g;g="function"==typeof p.lineSmooth?p.lineSmooth:p.lineSmooth?lt():ot();const f=g(u,m);if(p.showPoint&&f.pathElements.forEach((s=>{const{data:a}=s,r=n.elem("line",{x1:s.x,y1:s.y,x2:s.x+.01,y2:s.y},t.classNames.point);if(a){let t,e;I(a.value,"x")&&(t=a.value.x),I(a.value,"y")&&(e=a.value.y),r.attr({"ct:value":[t,e].filter(O).join(","),"ct:meta":Y(a.meta)})}this.eventEmitter.emit("draw",{type:"point",value:null==a?void 0:a.value,index:(null==a?void 0:a.valueIndex)||0,meta:null==a?void 0:a.meta,series:e,seriesIndex:i,axisX:l,axisY:h,group:n,element:r,x:s.x,y:s.y,chartRect:o})})),p.showLine){const a=n.elem("path",{d:f.stringify()},t.classNames.line,!0);this.eventEmitter.emit("draw",{type:"line",values:s.series[i],path:f.clone(),chartRect:o,index:i,series:e,seriesIndex:i,meta:d,axisX:l,axisY:h,group:n,element:a})}if(p.showArea&&h.range){const a=Math.max(Math.min(p.areaBase,h.range.max),h.range.min),r=o.y1-h.projectValue(a);f.splitByCommand("M").filter((t=>t.pathElements.length>1)).map((t=>{const e=t.pathElements[0],s=t.pathElements[t.pathElements.length-1];return t.clone(!0).position(0).remove(1).move(e.x,r).line(e.x,e.y).position(t.pathElements.length+1).line(s.x,r)})).forEach((a=>{const r=n.elem("path",{d:a.stringify()},t.classNames.area,!0);this.eventEmitter.emit("draw",{type:"area",values:s.series[i],path:a.clone(),series:e,seriesIndex:i,axisX:l,axisY:h,chartRect:o,index:i,group:n,element:r,meta:d})}))}}),t.reverseData),this.eventEmitter.emit("created",{chartRect:o,axisX:l,axisY:h,svg:i,options:t})}constructor(t,e,s,i){super(t,e,yt,$({},yt,s),i),this.data=e}}class bt{constructor(t){this._model=t,this.root=document}get model(){return this._model}bindAll(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document;this.root=t;for(const t in this._model)this._model.hasOwnProperty(t)&&this.bind(t)}bind(t){const e="bind";this.root.querySelectorAll(`[data-${e}]`).forEach((s=>{s.dataset[e]===t&&(s instanceof HTMLInputElement||s instanceof HTMLSelectElement||s instanceof HTMLTextAreaElement?this.onChangeBind(s,t):s instanceof HTMLAnchorElement||s instanceof HTMLButtonElement?this.onClickBind(s,t):this.viewUpdateBind(s,t))}))}onClickBind(t,e){t.addEventListener("click",(t=>{if("function"!=typeof this._model[e])throw new Error(`Property ${e} is not a callback`);this._model[e](t),t.preventDefault()}))}onChangeBind(t,s){let i="value",n=t=>t;"checkbox"===t.type&&(i="checked",n=t=>!!t),t.addEventListener("change",(()=>{this._model[s]=t[i]})),e.observe(this.model,s,(e=>{e=n(e),t[i]!==e&&(t[i]=e)}))}viewUpdateBind(t,s){e.observe(this.model,s,(e=>{t.innerHTML!==e&&(t.innerHTML=e)}))}onChanged(t,s){e.observe(this.model,t,s)}unsubscribe(t,s){e.unobserve(this.model,t,s)}getBoundElement(t){return this.root.querySelector(`[data-bind='${t}']`)}}var xt=n(472),wt=n.n(xt);class kt extends bt{constructor(t){super({pointSelected:null,chartVisible:!1,buttonVisible:!1,onChartToggle:null,onMenuToggle:null}),this.state=t,this.data=[],this.chart=null,this.chartPoints=null,this.chartElement=document.querySelector("#chart"),this.chartContainer=this.chartElement.parentElement,this.buttonElement=document.querySelector("#altitudes")}init(){return this.chartSetup(),this.setObservers(),this.bindAll(),this}chartSetup(){a.addCss("css/dist/chartist.css","chartist_css"),this.chart=kt.getChart(this.chartElement,this.data),this.chart.on("created",(()=>this.onCreated()))}static getChart(t,e){return new vt(t,{series:[e]},{lineSmooth:!0,showArea:!0,axisX:{type:pt,onlyInteger:!0,showLabel:!1},plugins:[wt()({axisY:{axisTitle:`${v._("altitude")} (${v.unit("unitDistance")} ${v.unit("unitAltitude")})`,axisClass:"ct-axis-title",offset:{x:0,y:11},textAnchor:"middle",flipTitle:!0}})]})}onCreated(){if(this.data.length&&this.data.length<=1e3){this.chartPoints=document.querySelectorAll(".ct-series .ct-point");const t=this.chartPoints.length;for(let e=0;e<t;e++)this.chartPoints[e].addEventListener("click",(()=>{this.model.pointSelected=e}))}}setObservers(){this.state.onChanged("currentTrack",(t=>{t&&e.observe(t,"positions",(()=>{this.onTrackUpdate(t,!0)})),this.onTrackUpdate(t)})),this.onChanged("buttonVisible",(t=>this.renderButton(t))),this.onChanged("chartVisible",(t=>this.renderContainer(t))),this.model.onChartToggle=()=>{this.model.chartVisible=!this.model.chartVisible},this.model.onMenuToggle=()=>{this.model.chartVisible&&this.chart.update()}}onTrackUpdate(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.render(t,e),this.model.buttonVisible=!!t&&t.hasPlotData}renderContainer(t){t?(this.chartContainer.style.display="block",this.render(this.state.currentTrack)):this.chartContainer.style.display="none"}renderButton(t){t?this.buttonElement.classList.remove("menu-hidden"):this.buttonElement.classList.add("menu-hidden")}render(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],s=[];if(t&&t.hasPlotData&&this.model.chartVisible?s=t.plotData:this.model.chartVisible=!1,e||this.data!==s){s.length,this.data=s;const t={lineSmooth:s.length<=1e3};this.chart.update({series:[s]},t,!0)}}pointAddClass(t,e){if(this.model.chartVisible&&this.chartPoints&&this.chartPoints.length>t){this.chartPoints[t].classList.add(e)}}pointsRemoveClass(t){this.model.chartVisible&&this.chartPoints&&this.chartPoints.forEach((e=>e.classList.remove(t)))}onPointOver(t){this.pointAddClass(t,"ct-point-hilight")}onPointOut(){this.pointsRemoveClass("ct-point-hilight")}onPointSelect(t){this.pointAddClass(t,"ct-point-selected")}onPointUnselect(){this.pointsRemoveClass("ct-point-selected")}}class Et{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.autoClose=e.autoClose||0,this.hasButton=void 0!==e.hasButton?e.hasButton:0===this.autoClose,this.fixedPosition=e.fixed||!1;const s=`<div class="alert"><span>${t}</span></div>`;if(this.box=a.nodeFromHtml(s),e.id&&(this.box.id=e.id),e.class&&this.box.classList.add(e.class),this.hasButton){const t=document.createElement("button");t.setAttribute("type","button"),t.textContent="",t.onclick=()=>this.destroy(),this.box.appendChild(t)}this.closeHandle=null}static getPosition(){const t=document.querySelectorAll(".alert"),e=t[t.length-1];let s=0;if(e){const t=document.body.clientHeight-100;s=e.getBoundingClientRect().bottom,s>t&&(s=t)}return s}render(){if(!this.fixedPosition){const t=Et.getPosition();t&&(this.box.style.top=`${t}px`)}document.body.appendChild(this.box),setTimeout((()=>{this.box&&this.box.classList.add("in")}),50)}destroy(){if(this.closeHandle&&(clearTimeout(this.closeHandle),this.closeHandle=null),this.box&&document.body.contains(this.box)){const t=this.box;requestAnimationFrame((()=>{t.classList.add("out"),setTimeout((()=>{t.remove()}),1e3)})),this.box=null}}static show(t,e){const s=new Et(t,e);return s.render(),s.autoClose&&(s.closeHandle=setTimeout((()=>s.destroy()),s.autoClose)),s}static error(t,e){return e instanceof Error&&console.error(`${e.name}: ${e.message} (${e.stack})`),this.show(t,{class:"error"})}static toast(t){return this.show(t,{class:"toast",autoClose:1e4})}static spinner(){return this.show("",{class:"spinner",hasButton:!1,fixed:!0})}}class St{constructor(t){const e=document.createElement("div");e.setAttribute("id","modal");const s=document.createElement("div");s.setAttribute("id","modal-header");const i=document.createElement("button");i.setAttribute("id","modal-close"),i.setAttribute("type","button"),i.setAttribute("class","button-reject"),i.setAttribute("data-bind","onCancel");const n=document.createElement("img");n.setAttribute("src","images/close.svg"),n.setAttribute("alt",v._("close")),i.append(n),s.append(i);const a=document.createElement("div");if(a.setAttribute("id","modal-body"),"string"==typeof t)a.innerHTML=t;else if(t instanceof NodeList||t instanceof Array)for(const e of t)a.append(e);else a.append(t);a.prepend(s),e.append(a),this.element=e,this.visible=!1}show(){this.visible||(document.body.append(this.element),this.visible=!0,this.autofocus())}autofocus(){const t=this.element.querySelector("[autofocus]");t&&t.focus()}destroy(){document.body.removeChild(this.element),this.visible=!1}static isConfirmed(t){return confirm(t)}}class Lt extends bt{constructor(){super({colorExtra:y.colorExtra,colorHilite:y.colorHilite,colorNormal:y.colorNormal,colorStart:y.colorStart,colorStop:y.colorStop,googleKey:y.googleKey,initLatitude:y.initLatitude,initLongitude:y.initLongitude,interval:y.interval,lang:y.lang,layerId:0,layerName:null,layers:new u(new d(0,"OpenStreetMap","",0),...y.olLayers),layerUrl:null,mapApi:y.mapApi,passLenMin:y.passLenMin,passStrength:y.passStrength,publicTracks:y.publicTracks,requireAuth:y.requireAuth,strokeColor:y.strokeColor,strokeOpacity:y.strokeOpacity,strokeWeight:y.strokeWeight,units:y.units,uploadMaxSize:y.uploadMaxSize,uploadMaxSizeMB:y.uploadMaxSize/1024/1024}),this.model.onCancel=()=>this.onCancel(),this.model.onSave=()=>this.onSave(),this.model.onLayerUpdate=()=>this.onLayerUpdate(),this.model.onLayerCancel=()=>this.onLayerCancel(),this.model.onLayerEdit=()=>this.onLayerEdit(),this.model.onLayerDelete=()=>this.onLayerDelete(),this.model.onLayerAdd=()=>this.onLayerAdd()}init(){const t=this.getHtml();this.dialog=new St(t),this.dialog.show(),this.bindAll(this.dialog.element),this.toggleEditEl=this.getBoundElement("onLayerEdit").parentNode,this.layerEditEl=this.getBoundElement("layerName").parentNode,this.layerSelect=new s(this.getBoundElement("layerId")),this.setPublicTracksActivity(this.model.requireAuth),this.toggleEditVisible(),this.onChanged("layerId",(t=>{const e=this.model.layers.get(parseInt(t));this.model.layerName=e?e.name:"",this.model.layerUrl=e?e.url:"",this.toggleEditVisible()})),this.model.layerId=y.olLayers.getPriorityLayer().toString(),this.onChanged("uploadMaxSizeMB",(t=>{this.model.uploadMaxSize=1024*t*1024})),this.onChanged("layers",(t=>this.layerSelect.setOptions(t))),this.onChanged("requireAuth",(t=>{this.setPublicTracksActivity(t)}))}setPublicTracksActivity(t){t?this.getBoundElement("publicTracks").disabled=!1:(this.model.publicTracks=!0,this.getBoundElement("publicTracks").disabled=!0)}onCancel(){this.dialog.destroy()}onSave(){this.validate()&&(this.model.layers.setPriorityLayer(parseInt(this.model.layerId)),y.save(this.model).then((()=>this.dialog.destroy())).catch((t=>{Et.error(`${v._("actionfailure")}\n${t.message}`,t)})))}validate(){return this.dialog.element.querySelector("form").checkValidity()}toggleEditVisible(){parseInt(this.model.layerId)>0?this.toggleEditEl.style.visibility="visible":(this.toggleEditEl.style.visibility="hidden",this.hideEditElement())}onLayerDelete(){this.model.layers.delete(parseInt(this.model.layerId)),this.model.layerId="0"}onLayerEdit(){"none"===this.layerEditEl.style.display?this.showEditElement():this.hideEditElement()}onLayerUpdate(){if(this.model.layerName&&this.model.layerUrl){if("-1"===this.model.layerId)this.model.layers.addNewLayer(this.model.layerName,this.model.layerUrl);else{const t=this.currentLayer();t.setName(this.model.layerName),t.setUrl(this.model.layerUrl)}this.hideEditElement(),this.layerSelect.setOptions(this.model.layers)}}onLayerCancel(){this.hideEditElement(),this.layerSelect.setOptions(this.model.layers)}onLayerAdd(){this.model.layerId="-1",this.onLayerEdit()}hideEditElement(){this.layerEditEl.style.display="none"}showEditElement(){this.layerEditEl.style.display="block"}currentLayer(){return this.model.layers.get(parseInt(this.model.layerId))}getHtml(){let t="";for(const[e,s]of Object.entries(v.getLangList()))t+=`<option value="${e}"${this.model.lang===e?" selected":""}>${s}</option>`;let e="";for(const t of["metric","imperial","nautical"])e+=`<option value="${t}"${this.model.units===t?" selected":""}>${v._(t)}</option>`;let s="";for(const t of this.model.layers)s+=`<option value="${t.id}"${t.priority>0?" selected":""}>${t.name}</option>`;return`<div><img style="vertical-align: bottom; margin-right: 10px;" src="images/settings.svg" alt="${v._("settings")}"> <b>${v._("editingconfig")}</b></div>\n      <div style="clear: both; padding-bottom: 1em;"></div>\n      <form id="config-form">\n        <label><b>${v._("language")}</b>\n        <select data-bind="lang">\n          ${t}\n        </select></label>\n        <label><b>${v._("units")}</b>\n        <select data-bind="units">\n          ${e}\n        </select></label>\n        <label><b>${v._("api")}</b>\n        <select data-bind="mapApi">\n          <option value="openlayers"${"openlayers"===this.model.mapApi?" selected":""}>OpenLayers</option>\n          <option value="gmaps"${"gmaps"===this.model.mapApi?" selected":""}>Google Maps</option>\n        </select></label>\n        <label><b>${v._("ollayers")}</b>\n        <select data-bind="layerId">\n          ${s}\n        </select>\n        <a data-bind="onLayerAdd"><img src="images/add.svg" alt="${v._("add")}"></a> \n        <span style="visibility: hidden;">\n        <a data-bind="onLayerEdit"><img src="images/edit.svg" alt="${v._("edit")}"></a> \n        <a data-bind="onLayerDelete"><img src="images/delete.svg" alt="${v._("delete")}"></a>\n        </span></label>\n        <div style="display: none; text-align: center;">\n          <input type="text" maxlength="50" placeholder="${v._("layername")}" data-bind="layerName">\n          <input type="text" maxlength="255" placeholder="${v._("layerurl")}" data-bind="layerUrl">\n          <button class="button-resolve" data-bind="onLayerUpdate" type="submit">${v._("submit")}</button>\n          <button class="button-reject" data-bind="onLayerCancel" type="button">${v._("cancel")}</button>\n        </div>\n        <label><b>${v._("interval")}</b>\n        <input type="number" data-bind="interval" min="1" value="${this.model.interval}" required></label>\n        <label><b>${v._("longitude")}</b>\n        <input type="number" data-bind="initLongitude" min="-180" max="180" step="0.01" value="${this.model.initLongitude}" required></label>\n        <label><b>${v._("latitude")}</b>\n        <input type="number" data-bind="initLatitude" min="-90" max="90" step="0.01" value="${this.model.initLatitude}" required></label>\n        <label><b>${v._("googlekey")}</b>\n        <input type="text" data-bind="googleKey" value="${this.model.googleKey}"></label>\n        <label><b>${v._("passlength")}</b>\n        <input type="number" data-bind="passLenMin" min="1" value="${this.model.passLenMin}" required></label>\n        <label><b>${v._("passstrength")}</b>\n        <select data-bind="passStrength">\n          <option value="0"${0===this.model.passStrength?" selected":""}>password</option>\n          <option value="1"${1===this.model.passStrength?" selected":""}>paSsword</option>\n          <option value="2"${2===this.model.passStrength?" selected":""}>paSsword1</option>\n          <option value="3"${3===this.model.passStrength?" selected":""}>paSsword1#</option>\n        </select></label>\n        <label><b>${v._("uploadmaxsize")}</b>\n        <input type="number" data-bind="uploadMaxSizeMB" min="1" value="${this.model.uploadMaxSizeMB}" required></label>\n        <label><b>${v._("requireauth")}</b>\n        <input type="checkbox" data-bind="requireAuth"${this.model.requireAuth?" checked":""}></label>\n        <label><b>${v._("publictracks")}</b>\n        <input type="checkbox" data-bind="publicTracks"${this.model.publicTracks?" checked":""}></label>\n        <label><b>${v._("strokeweight")}</b>\n        <input type="number" data-bind="strokeWeight" min="1" value="${this.model.strokeWeight}" required></label>\n        <label><b>${v._("strokeopacity")}</b>\n        <input type="number" data-bind="strokeOpacity" min="0" max="1" step="0.01" value="${this.model.strokeOpacity}" required></label>\n        <label><b>${v._("strokecolor")}</b>\n        <input type="color" data-bind="strokeColor" pattern="#[0-9a-f]{6}" maxlength="7" value="${this.model.strokeColor}" required></label>\n        <label><b>${v._("colornormal")}</b>\n        <input type="color" data-bind="colorNormal" pattern="#[0-9a-f]{6}" maxlength="7" value="${this.model.colorNormal}" required></label>\n        <label><b>${v._("colorstart")}</b>\n        <input type="color" data-bind="colorStart" pattern="#[0-9a-f]{6}" maxlength="7" value="${this.model.colorStart}" required></label>\n        <label><b>${v._("colorstop")}</b>\n        <input type="color" data-bind="colorStop" pattern="#[0-9a-f]{6}" maxlength="7" value="${this.model.colorStop}" required></label>\n        <label><b>${v._("colorextra")}</b>\n        <input type="color" data-bind="colorExtra" pattern="#[0-9a-f]{6}" maxlength="7" value="${this.model.colorExtra}" required></label>\n        <label><b>${v._("colorhilite")}</b>\n        <input type="color" data-bind="colorHilite" pattern="#[0-9a-f]{6}" maxlength="7" value="${this.model.colorHilite}" required></label>\n        <div class="buttons">\n          <button class="button-reject" data-bind="onCancel" type="button">${v._("cancel")}</button>\n          <button class="button-resolve" data-bind="onSave" type="submit">${v._("submit")}</button>\n        </div>\n      </form>`}}class At extends bt{constructor(t){super(y),this.state=t,this.model.onSetInterval=()=>this.setAutoReloadInterval(),this.model.onConfigEdit=()=>this.showConfigDialog()}init(){return this.setObservers(),this.bindAll(),this}setObservers(){this.onChanged("mapApi",(t=>{a.setCookie("api",t)})),this.onChanged("lang",(t=>{a.setCookie("lang",t),At.reload()})),this.onChanged("units",(t=>{a.setCookie("units",t),At.reload()})),this.onChanged("interval",(t=>{a.setCookie("interval",t)}))}static reload(){window.location.reload()}setAutoReloadInterval(){const t=parseInt(prompt(v._("newinterval")));isNaN(t)||t===this.model.interval||(this.model.interval=t)}showConfigDialog(){new Lt(this).init()}}const Ct="menu-hidden";class Mt extends bt{constructor(t){super({onMenuToggle:null,onShowUserMenu:null,onLogin:null,onLogout:null}),this.state=t,this.model.onMenuToggle=()=>this.toggleSideMenu(),this.model.onShowUserMenu=()=>this.toggleUserMenu(),this.model.onLogin=()=>Mt.login(),this.model.onLogout=()=>Mt.logout(),this.hideUserMenuCallback=t=>this.hideUserMenu(t),this.menuEl=document.querySelector("#menu"),this.userMenuEl=document.querySelector("#user-menu")}init(){return this.bindAll(),this}toggleSideMenu(){this.menuEl.classList.contains(Ct)?this.menuEl.classList.remove(Ct):this.menuEl.classList.add(Ct)}toggleUserMenu(){this.userMenuEl.classList.contains(Ct)?(this.userMenuEl.classList.remove(Ct),window.addEventListener("click",this.hideUserMenuCallback,!0)):this.userMenuEl.classList.add(Ct)}hideUserMenu(t){const e=t.target;this.userMenuEl.classList.add(Ct),window.removeEventListener("click",this.hideUserMenuCallback,!0),"user-menu"!==e.parentElement.id&&t.stopPropagation()}static login(){a.openUrl(`login.php${window.location.hash}`)}static logout(){let t="utils/logout.php";y.requireAuth||(t+=`?hash=${window.location.hash.replace("#","")}`),a.openUrl(t)}}class _t{constructor(t){this.map=null,this.viewModel=t,this.polies=[],this.markers=[],this.popup=null,this.timeoutHandle=0}init(){const t=`?${y.googleKey?`key=${y.googleKey}&`:""}callback=gm_loaded`;return Promise.all([_t.onScriptLoaded(),a.loadScript(`https://maps.googleapis.com/maps/api/js${t}`,"mapapi_gmaps",_t.loadTimeoutMs)]).then((()=>this.initMap()))}static onScriptLoaded(){const t=a.timeoutPromise(_t.loadTimeoutMs),e=new Promise(((t,e)=>{window.gm_loaded=()=>{_t.gmInitialized=!0,t()},window.gm_authFailure=()=>{_t.authError=!0;let t=v._("apifailure","Google Maps");t+="<br><br>"+v._("gmauthfailure"),t+="<br><br>"+v._("gmapilink"),_t.gmInitialized&&Et.error(t),e(new Error(t))},_t.authError&&window.gm_authFailure(),_t.gmInitialized&&window.gm_loaded()}));return Promise.race([e,t])}initMap(){const t={center:new google.maps.LatLng(y.initLatitude,y.initLongitude),zoom:8,mapTypeId:google.maps.MapTypeId.TERRAIN,scaleControl:!0,controlSize:30};this.map=new google.maps.Map(this.viewModel.mapElement,t),this.popup=new google.maps.InfoWindow,this.popup.addListener("closeclick",(()=>{this.popupClose()})),this.saveState=()=>{this.viewModel.state.mapParams=this.getState()}}cleanup(){this.polies.length=0,this.markers.length=0,this.popup=null,this.map&&this.map.getDiv()&&(this.map.getDiv().innerHTML=""),this.map=null}displayTrack(t,e){if(!t||!t.hasPositions)return Promise.resolve();google.maps.event.clearListeners(this.map,"idle");const s=new Promise((t=>{google.maps.event.addListenerOnce(this.map,"tilesloaded",(()=>{this.map&&(this.saveState(),this.map.addListener("idle",this.saveState)),t()}))})),i={strokeColor:y.strokeColor,strokeOpacity:y.strokeOpacity,strokeWeight:y.strokeWeight};let n;const a=new google.maps.LatLngBounds;if(this.polies.length){n=this.polies[0];for(let t=0;t<this.markers.length;t++)a.extend(this.markers[t].getPosition())}else n=new google.maps.Polyline(i),n.setMap(this.map),this.polies.push(n);const r=n.getPath();let o=this.markers.length;o>0&&this.removePoint(--o);for(let e=o;e<t.length;e++){this.setMarker(e,t);const s=t.positions[e],i=new google.maps.LatLng(s.latitude,s.longitude);t instanceof l&&r.push(i),a.extend(i)}if(e&&(this.map.fitBounds(a),1===t.length)){const t=google.maps.event.addListenerOnce(this.map,"bounds_changed",(function(){this.getZoom()&&this.setZoom(15)}));setTimeout((()=>{google.maps.event.removeListener(t)}),2e3)}return s}clearMap(){if(this.polies)for(let t=0;t<this.polies.length;t++)this.polies[t].setMap(null);if(this.markers)for(let t=0;t<this.markers.length;t++)this.markers[t].setMap(null);this.popup.getMap()&&this.popupClose(),this.popup.setContent(""),this.markers.length=0,this.polies.length=0}static getMarkerIcon(t,e,s){return{anchor:new google.maps.Point(15,35),url:Ot.getSvgSrc(t,e,s)}}setMarker(t,e){const s=e.positions[t],i=new google.maps.Marker({position:new google.maps.LatLng(s.latitude,s.longitude),title:new Date(1e3*s.timestamp).toLocaleString(),map:this.map}),n=s.hasComment()||s.hasImage();let a;a=e.isLastPosition(t)?_t.getMarkerIcon(y.colorStop,!0,n):e.isFirstPosition(t)?_t.getMarkerIcon(y.colorStart,!0,n):_t.getMarkerIcon(n?y.colorExtra:y.colorNormal,!1,n),i.setIcon(a),i.addListener("click",(()=>{this.popupOpen(t,i)})),i.addListener("mouseover",(()=>{this.viewModel.model.markerOver=t})),i.addListener("mouseout",(()=>{this.viewModel.model.markerOver=null})),this.markers.push(i)}removePoint(t){this.markers.length>t&&(this.markers[t].setMap(null),this.markers.splice(t,1),this.polies.length&&this.polies[0].getPath().removeAt(t),this.viewModel.model.markerSelect===t&&this.popupClose())}popupOpen(t,e){this.popup.setContent(this.viewModel.getPopupElement(t)),this.popup.open(this.map,e),this.viewModel.model.markerSelect=t}popupClose(){this.viewModel.model.markerSelect=null,this.popup.close()}animateMarker(t){this.popup.getMap()&&(this.popupClose(),clearTimeout(this.timeoutHandle));const e=this.markers[t].getIcon();this.markers[t].setIcon(_t.getMarkerIcon(y.colorHilite,!1,!1)),this.markers[t].setAnimation(google.maps.Animation.BOUNCE),this.timeoutHandle=setTimeout((()=>{this.markers[t].setIcon(e),this.markers[t].setAnimation(null)}),2e3)}getBounds(){const t=this.map.getBounds(),e=t.getSouthWest().lat(),s=t.getSouthWest().lng(),i=t.getNorthEast().lat();return[s,e,t.getNorthEast().lng(),i]}zoomToExtent(){const t=new google.maps.LatLngBounds;for(let e=0;e<this.markers.length;e++)t.extend(this.markers[e].getPosition());this.map.fitBounds(t)}zoomToBounds(t){const e=new google.maps.LatLng(t[1],t[0]),s=new google.maps.LatLng(t[3],t[2]),i=new google.maps.LatLngBounds(e,s);this.map.fitBounds(i)}isPositionVisible(t){return!(t>=this.markers.length)&&this.map.getBounds().contains(this.markers[t].getPosition())}centerToPosition(t){t<this.markers.length&&this.map.setCenter(this.markers[t].getPosition())}updateSize(){}setTrackDefaultStyle(){}setTrackGradientStyle(t,e,s){}static get loadTimeoutMs(){return 1e4}updateState(t){this.map.setCenter({lat:t.center[0],lng:t.center[1]}),this.map.setZoom(t.zoom)}getState(){if(this.map){const t=this.map.getCenter();return{center:[t.lat(),t.lng()],zoom:this.map.getZoom(),rotation:0}}return null}saveState(){}}_t.authError=!1,_t.gmInitialized=!1;let $t;class Tt{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.map=null,this.viewModel=t,this.layerTrack=null,this.layerMarkers=null,this.selectedLayer=null,this.markerStyles=null,this.popup=null,e&&($t=e)}init(){a.addCss("css/dist/ol.css","ol_css");return($t?Promise.resolve():n.e(521).then(n.bind(n,173)).then((t=>{$t=t}))).then((()=>{this.initMap(),this.initLayers(),this.initStyles(),this.initPopups()}))}initMap(){const t=[new $t.control.Zoom,new $t.control.Rotate,new $t.control.ScaleLine],e=new $t.View({center:$t.proj.fromLonLat([y.initLongitude,y.initLatitude]),zoom:8});this.map=new $t.Map({target:this.viewModel.mapElement,controls:t,view:e}),this.map.on("pointermove",(t=>{const e=this.map.forEachFeatureAtPixel(t.pixel,((t,e)=>"Markers"===e.get("name")?t:null));if(e){this.map.getTargetElement().style.cursor="pointer";const t=e.getId();t!==this.viewModel.model.markerOver&&(this.viewModel.model.markerOver=t)}else this.map.getTargetElement().style.cursor="",this.viewModel.model.markerOver=null})),this.saveState=()=>{this.viewModel.state.mapParams=this.getState()}}initLayers(){const t=new $t.layer.TileLayer({name:"OpenStreetMap",visible:!0,source:new $t.source.OSM});this.map.addLayer(t),this.selectedLayer=t;for(const t of y.olLayers){const e=new $t.layer.TileLayer({name:t.name,visible:!1,source:new $t.source.XYZ({url:t.url})});this.map.addLayer(e),t.priority&&(this.selectedLayer.setVisible(!1),this.selectedLayer=e,this.selectedLayer.setVisible(!0))}this.layerTrack=new $t.layer.VectorLayer({name:"Track",type:"data",source:new $t.source.Vector}),this.layerMarkers=new $t.layer.VectorLayer({name:"Markers",type:"data",source:new $t.source.Vector}),this.map.addLayer(this.layerTrack),this.map.addLayer(this.layerMarkers),this.initLayerSwitcher()}initStyles(){const t=[.5,1];this.markerStyles={start:new $t.style.Style({image:new $t.style.Icon({anchor:t,src:Ot.getSvgSrc(y.colorStart,!0)})}),stop:new $t.style.Style({image:new $t.style.Icon({anchor:t,src:Ot.getSvgSrc(y.colorStop,!0)})}),normal:new $t.style.Style({image:new $t.style.Icon({anchor:t,opacity:.7,src:Ot.getSvgSrc(y.colorNormal,!1)})}),extra:new $t.style.Style({image:new $t.style.Icon({anchor:t,src:Ot.getSvgSrc(y.colorExtra,!1,!0)})}),startExtra:new $t.style.Style({image:new $t.style.Icon({anchor:t,src:Ot.getSvgSrc(y.colorStart,!0,!0)})}),stopExtra:new $t.style.Style({image:new $t.style.Icon({anchor:t,src:Ot.getSvgSrc(y.colorStop,!0,!0)})}),hilite:new $t.style.Style({image:new $t.style.Icon({anchor:t,src:Ot.getSvgSrc(y.colorHilite,!1)})})}}setTrackDefaultStyle(){const t=new $t.style.Style({stroke:new $t.style.Stroke({color:a.hexToRGBA(y.strokeColor,y.strokeOpacity),width:y.strokeWeight})});this.layerTrack.setStyle(t)}getGradientStyle(t,e,s){const i=this.map.getPixelFromCoordinate(e[0]),n=this.map.getPixelFromCoordinate(e[1]),a=window.devicePixelRatio,r=i[0]*a,o=i[1]*a,l=n[0]*a,h=n[1]*a,c=t.createLinearGradient(r,o,l,h);return c.addColorStop(0,s[0]),c.addColorStop(1,s[1]),new $t.style.Style({geometry:new $t.geom.LineString(e),stroke:new $t.style.Stroke({color:c,width:2*y.strokeWeight})})}setTrackGradientStyle(t,e,s){const i=s.minValue,n=s.maxValue,r=s.minColor,o=s.maxColor;if(t.length<2||n<i)return void this.setTrackDefaultStyle();const l=document.createElement("canvas",{alpha:!1,desynchronized:!0}).getContext("2d");this.layerTrack.setStyle((s=>{const h=[new $t.style.Style({stroke:new $t.style.Stroke({color:"grey",width:2*y.strokeWeight+2})})],c=s.getGeometry();if(i===n)return h.push(new $t.style.Style({geometry:c,stroke:new $t.style.Stroke({color:a.getScaleColor(r,o,.5),width:2*y.strokeWeight})})),h;let d=t.positions[0];const u=null!==d[e]?d[e]:0;let m=a.getScaleColor(r,o,(u-i)/(n-i)),p=1;return c.forEachSegment(((s,c)=>{let u;d=t.positions[p],u=null!==d[e]?a.getScaleColor(r,o,(d[e]-i)/(n-i)):m,h.push(this.getGradientStyle(l,[s,c],[m,u])),m=u,p++})),h}))}initPopups(){const t=document.createElement("div");t.id="popup-container",t.className="ol-popup";const e=document.createElement("div");e.id="popup-content",t.appendChild(e);const s=document.createElement("a");s.className="ol-popup-closer",t.appendChild(s),this.popup=new $t.Overlay({element:t,autoPan:!0,autoPanAnimation:{duration:250}}),this.map.addOverlay(this.popup),s.onclick=()=>(this.popupClose(),s.blur(),!1),this.map.on("click",(t=>{const e=t.coordinate,s=this.map.forEachFeatureAtPixel(t.pixel,((t,e)=>"Markers"===e.get("name")?t:null));s?this.popupOpen(s.getId(),e):this.popupClose()}))}popupOpen(t,e){this.popup.getElement().firstElementChild.innerHTML="",this.popup.getElement().firstElementChild.appendChild(this.viewModel.getPopupElement(t)),this.popup.setPosition(e),this.viewModel.model.markerSelect=t}popupClose(){this.popup&&(this.popup.setPosition(void 0),this.popup.getElement().firstElementChild.innerHTML=""),this.viewModel.model.markerSelect=null}switchLayer(t){this.map.getLayers().forEach((e=>{e.get("name")===t&&("data"===e.get("type")?e.getVisible()?e.setVisible(!1):e.setVisible(!0):(this.selectedLayer.setVisible(!1),this.selectedLayer=e,e.setVisible(!0)))}))}initLayerSwitcher(){const t=document.createElement("div");t.id="switcher",t.className="ol-control",document.body.appendChild(t);const e=document.createElement("div");e.id="switcher-content",e.className="ol-layerswitcher",t.appendChild(e);const s=document.createElement("a");s.className="ol-popup-closer",t.appendChild(s),this.map.getLayers().forEach((t=>{const s=document.createElement("label");s.innerHTML=t.get("name"),e.appendChild(s);const i=document.createElement("input");"data"===t.get("type")?(i.type="checkbox",s.className="ol-datalayer"):i.type="radio",i.name="layer",i.value=t.get("name"),i.onclick=t=>{const e=t.target;this.switchLayer(e.value)},t.getVisible()&&(i.checked=!0),s.insertBefore(i,s.childNodes[0])}));const i=document.createElement("button"),n=a.nodeFromHtml('<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="currentColor" d="M21.698 10.658l2.302 1.342-12.002 7-11.998-7 2.301-1.342 9.697 5.658 9.7-5.658zm-9.7 10.657l-9.697-5.658-2.301 1.343 11.998 7 12.002-7-2.302-1.342-9.7 5.657zm0-19l8.032 4.685-8.032 4.685-8.029-4.685 8.029-4.685zm0-2.315l-11.998 7 11.998 7 12.002-7-12.002-7z"/></svg>\n');n.style.width="60%",i.appendChild(n);const r=()=>{"block"===t.style.display?t.style.display="none":t.style.display="block"};s.addEventListener("click",r,!1),i.addEventListener("click",r,!1),i.addEventListener("touchstart",r,!1);const o=document.createElement("div");o.className="ol-switcher-button ol-unselectable ol-control",o.appendChild(i);const l=new $t.control.Control({element:o});this.map.addControl(l)}cleanup(){this.layerTrack=null,this.layerMarkers=null,this.selectedLayer=null,this.markerStyles=null,a.removeElementById("switcher"),this.map&&this.map.getTargetElement()&&(this.map.getTargetElement().innerHTML=""),this.map=null}displayTrack(t,e){if(!t||!t.hasPositions)return Promise.resolve();this.map.un("moveend",this.saveState);const s=new Promise((t=>{this.map.once("rendercomplete",(()=>{this.map&&(this.saveState(),this.map.on("moveend",this.saveState)),t()}))}));let i=this.layerMarkers?this.layerMarkers.getSource().getFeatures().length:0;i>0&&this.removePoint(--i);for(let e=i;e<t.length;e++)this.setMarker(e,t);if(t instanceof l){let e;if(this.layerTrack&&this.layerTrack.getSource().getFeatures().length)e=this.layerTrack.getSource().getFeatures()[0].getGeometry();else{e=new $t.geom.LineString([]);const t=new $t.Feature({geometry:e});this.layerTrack.getSource().addFeature(t)}for(let s=i;s<t.length;s++){const i=t.positions[s];e.appendCoordinate($t.proj.fromLonLat([i.longitude,i.latitude]))}}let n=this.layerMarkers.getSource().getExtent();return e&&(n=this.fitToExtent(n)),this.setZoomToExtent(n),s}setZoomToExtent(t){this.map.getControls().forEach((t=>{t instanceof $t.control.ZoomToExtent&&this.map.removeControl(t)})),this.map.addControl(new $t.control.ZoomToExtent({extent:t,label:Tt.getExtentImg()}))}fitToExtent(t){return this.map.getView().fit(t,{padding:Tt.TRACK_PADDING,maxZoom:Tt.ZOOM_MAX}),this.map.getView().calculateExtent()}isPositionVisible(t){const e=this.map.getView().calculateExtent(),s=this.layerMarkers.getSource().getFeatureById(t).getGeometry();return!!s&&$t.extent.containsCoordinate(e,s.getCoordinates())}centerToPosition(t){const e=this.layerMarkers.getSource().getFeatureById(t).getGeometry();e&&this.map.getView().setCenter(e.getCoordinates())}clearMap(){this.popupClose(),this.layerTrack&&this.layerTrack.getSource().clear(),this.layerMarkers&&this.layerMarkers.getSource().clear()}getMarkerStyle(t,e){const s=e.positions[t];let i=this.markerStyles.normal;return s.hasComment()||s.hasImage()?i=e.isLastPosition(t)?this.markerStyles.stopExtra:e.isFirstPosition(t)?this.markerStyles.startExtra:this.markerStyles.extra:e.isLastPosition(t)?i=this.markerStyles.stop:e.isFirstPosition(t)&&(i=this.markerStyles.start),i}setMarker(t,e){const s=e.positions[t],i=new $t.Feature({geometry:new $t.geom.Point($t.proj.fromLonLat([s.longitude,s.latitude]))}),n=this.getMarkerStyle(t,e);i.setStyle(n),i.setId(t),this.layerMarkers.getSource().addFeature(i)}removePoint(t){const e=this.layerMarkers.getSource().getFeatureById(t);if(e){if(this.layerMarkers.getSource().removeFeature(e),this.layerTrack){const e=this.layerTrack.getSource().getFeatures()[0].getGeometry(),s=e.getCoordinates();s.splice(t,1),e.setCoordinates(s)}this.viewModel.model.markerSelect===t&&this.popupClose()}}animateMarker(t){const e=this.layerMarkers.getSource().getFeatureById(t),s=e.getStyle();e.setStyle(this.markerStyles.hilite),setTimeout((()=>e.setStyle(s)),2e3)}getBounds(){const t=this.map.getView().calculateExtent(),e=$t.proj.toLonLat([t[0],t[1]]),s=$t.proj.toLonLat([t[2],t[3]]);return[e[0],e[1],s[0],s[1]]}zoomToExtent(){this.fitToExtent(this.layerMarkers.getSource().getExtent())}zoomToBounds(t){const e=$t.proj.fromLonLat([t[0],t[1]]),s=$t.proj.fromLonLat([t[2],t[3]]);this.map.getView().fit([e[0],e[1],s[0],s[1]])}updateSize(){this.map.updateSize()}static getExtentImg(){const t=a.nodeFromHtml('<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="currentColor" d="M24 0v10.999l-3.379-3.378-4.379 4.379-4.242-4.242 4.379-4.379-3.379-3.379h11zm-11.875 16.138l-4.242-4.242-4.504 4.483-3.379-3.378v10.999h11l-3.379-3.379 4.504-4.483z"/></svg>\n');return t.style.width="60%",t}updateState(t){this.map.getView().setCenter(t.center),this.map.getView().setZoom(t.zoom),this.map.getView().setRotation(t.rotation)}getState(){const t=this.map?this.map.getView():null;return t?{center:t.getCenter(),zoom:t.getZoom(),rotation:t.getRotation()}:null}saveState(){}}Tt.ZOOM_MAX=20,Tt.TRACK_PADDING=[40,10,10,10];const Pt="hidden";class It extends bt{constructor(t,e){super({onPositionDelete:null,onPositionUpdate:null,onCancel:null,comment:null,image:null,onImageDelete:null}),this.state=t,this.positionIndex=e,this.position=this.state.currentTrack.positions[e],this.model.comment=this.position.hasComment()?this.position.comment:"",this.model.image=this.position.image,this.model.onPositionDelete=()=>this.onPositionDelete(),this.model.onPositionUpdate=()=>this.onPositionUpdate(),this.model.onCancel=()=>this.onCancel(),this.model.onImageDelete=()=>this.onImageDelete(),this.onChanged("image",(t=>{t&&t!==this.position.image&&this.readImage()}))}init(){const t=this.getHtml();this.dialog=new St(t),this.dialog.show(),this.bindAll(this.dialog.element),this.previewEl=this.getBoundElement("imagePreview"),this.fileEl=this.getBoundElement("image"),this.imageDeleteEl=this.getBoundElement("onImageDelete"),this.initReader()}initReader(){this.reader=new FileReader,this.reader.addEventListener("load",(()=>{this.showThumbnail()}),!1),this.reader.addEventListener("error",(()=>{this.model.image=this.position.image}),!1)}readImage(){const t=this.fileEl.files[0];if(t){if(t.size>y.uploadMaxSize)return Et.error(v._("isizefailure",y.uploadMaxSize)),void(this.model.image=this.position.image);this.reader.readAsDataURL(t)}}showThumbnail(){this.previewEl.onload=()=>this.toggleImage(),this.previewEl.onerror=()=>{Et.error(v._("iuploadfailure")),this.model.image=this.position.image},this.previewEl.src=this.reader.result}toggleImage(){this.previewEl.classList.contains(Pt)?(this.previewEl.classList.remove(Pt),this.imageDeleteEl.classList.remove(Pt),this.fileEl.classList.add(Pt)):(this.previewEl.classList.add(Pt),this.imageDeleteEl.classList.add(Pt),this.fileEl.classList.remove(Pt))}onImageDelete(){this.model.image=null,this.toggleImage()}getHtml(){return`<div class="red-button button-resolve"><b><a data-bind="onPositionDelete">${v._("delposition")}</a></b></div>\n      <div>${v._("editingposition",this.positionIndex+1,`<b>${a.htmlEncode(this.position.trackname)}</b>`)}</div>\n      <div style="clear: both; padding-bottom: 1em;"></div>\n      <form id="positionForm">\n        <label><b>${v._("comment")}</b></label><br>\n        <textarea style="width:100%;" maxlength="255" rows="5" placeholder="${v._("comment")}" name="comment" \n        data-bind="comment" autofocus>${a.htmlEncode(this.model.comment)}</textarea>\n        <br><br>\n        <label><b>${v._("image")}</b></label><br>\n        <input type="file" name="image" data-bind="image" accept="image/png, image/jpeg, image/gif, image/bmp"${this.position.hasImage()?' class="hidden"':""}>\n        <img style="max-width:50px; max-height:50px" data-bind="imagePreview" ${this.position.hasImage()?`src="${this.position.getImagePath()}"`:'class="hidden"'}>\n        <a data-bind="onImageDelete" ${this.position.hasImage()?"":' class="hidden"'}>${v._("delimage")}</a>\n        <div class="buttons">\n          <button class="button-reject" data-bind="onCancel" type="button">${v._("cancel")}</button>\n          <button class="button-resolve" data-bind="onPositionUpdate" type="submit">${v._("submit")}</button>\n        </div>\n      </form>`}onPositionDelete(){St.isConfirmed(v._("positiondelwarn",this.positionIndex+1,a.htmlEncode(this.position.trackname)))&&this.position.delete().then((()=>{const t=this.state.currentTrack;this.state.currentTrack=null,t.positions.splice(this.positionIndex,1),t.recalculatePositions(),this.state.currentTrack=t,this.dialog.destroy()})).catch((t=>{Et.error(`${v._("actionfailure")}\n${t.message}`,t)}))}updateImage(){let t=Promise.resolve();return this.model.image!==this.position.image&&(t=null===this.model.image?this.position.imageDelete():this.position.imageAdd(this.fileEl.files[0])),t}onPositionUpdate(){this.model.comment.trim(),this.validate()&&(this.position.comment=this.model.comment,this.updateImage().then((()=>this.position.save())).then((()=>{e.forceUpdate(this.state,"currentTrack"),this.dialog.destroy()})).catch((t=>{Et.error(`${v._("actionfailure")}\n${t.message}`,t)})))}onCancel(){this.dialog.destroy()}validate(){return!(this.model.comment===this.position.comment&&this.model.image===this.position.image)}}class Ot extends bt{constructor(t){super({markerOver:null,markerSelect:null,onMenuToggle:null,speedVisible:!1,altitudeVisible:!1}),this.state=t,this.mapElement=document.querySelector("#map-canvas"),this.speedEl=this.getBoundElement("speedVisible"),this.altitudeEl=this.getBoundElement("altitudeVisible"),this.styleEl=this.getBoundElement("trackColor"),this.savedBounds=null,this.api=null}init(){return this.bindAll(),this.setObservers(),this}loadMapAPI(t){let e=this.api;if(this.api=null,e){try{this.savedBounds=e.getBounds()}catch(t){this.savedBounds=null}e.cleanup()}e=this.getApi(t),e.init().then((()=>{this.api=e,this.onReady()})).catch((e=>{let s=v._("apifailure",t);e&&e.message&&(s+=` (${e.message})`),Et.error(s,e),y.mapApi="gmaps"===t?"openlayers":"gmaps"}))}getApi(t){return"gmaps"===t?new _t(this):new Tt(this)}onReady(){if(this.state.currentTrack){let t=!0;this.savedBounds&&(this.api.zoomToBounds(this.savedBounds),t=!1),this.displayTrack(this.state.currentTrack,t)}}setObservers(){y.onChanged("mapApi",(t=>{this.loadMapAPI(t),this.toggleStyleOptions(),this.toggleStyleMenu()})),this.state.onChanged("currentTrack",(t=>{this.api&&(this.api.clearMap(),t&&(e.observe(t,"positions",(()=>{this.displayTrack(t,!1),t instanceof l&&!this.api.isPositionVisible(t.length-1)&&this.api.centerToPosition(t.length-1),this.toggleStyleOptions()})),this.displayTrack(t,!0)),this.toggleStyleOptions())})),this.state.onChanged("history",(()=>{const t=this.state.history;this.api&&t&&!t.trackId&&(t.mapApi?y.mapApi=t.mapApi:(t.mapParams?this.api.updateState(t.mapParams):this.api.zoomToExtent(),this.state.history=null))})),this.model.onMenuToggle=()=>this.onMapResize(),this.onChanged("speedVisible",(t=>{t&&(this.model.altitudeVisible=!1),this.setTrackStyle()})),this.onChanged("altitudeVisible",(t=>{t&&(this.model.speedVisible=!1),this.setTrackStyle()}))}displayTrack(t,e){this.state.jobStart(),e&&this.state.history&&this.state.history.mapParams&&(this.api.updateState(this.state.history.mapParams),e=!1),this.state.history=null,this.setTrackStyle(),this.api.displayTrack(t,e).finally((()=>this.state.jobStop()))}onMapResize(){this.api&&this.api.updateSize()}toggleStyleOptions(){const t=this.state.currentTrack;this.speedEl.disabled=!t||!t.hasSpeeds||t.length<=1,this.altitudeEl.disabled=!t||!t.hasAltitudes||t.length<=1}toggleStyleMenu(){"openlayers"===y.mapApi?this.styleEl.style.display="block":this.styleEl.style.display="none"}setTrackStyle(){const t=this.state.currentTrack;this.api&&t&&(this.model.speedVisible&&t.hasSpeeds?this.setSpeedStyle():this.model.altitudeVisible&&t.hasAltitudes?this.setAltitudeStyle():this.api.setTrackDefaultStyle())}setSpeedStyle(){const t=this.state.currentTrack,e={minValue:0,maxValue:t.maxSpeed,minColor:[0,255,0],maxColor:[255,0,0]};this.api.setTrackGradientStyle(t,"speed",e)}setAltitudeStyle(){const t=this.state.currentTrack,e={minValue:t.minAltitude,maxValue:t.maxAltitude,minColor:[0,255,0],maxColor:[255,0,0]};this.api.setTrackGradientStyle(t,"altitude",e)}getPopupElement(t){const e=this.state.currentTrack.positions[t],s=this.state.currentTrack.length,i=this.state.currentTrack.user,n=b.user&&(b.isAdmin||b.user.id===i.id);let r="",o="";if(e.timestamp>0){const t=a.getTimeString(new Date(1e3*e.timestamp));r=t.date,o=`${t.time}<span class="smaller">${t.zone}</span>`}let l="";"gps"===e.provider?l=` <img class="icon" alt="${v._("gps")}" title="${v._("gps")}"  src="images/gps_dark.svg">`:"network"===e.provider&&(l=` <img class="icon" alt="${v._("network")}" title="${v._("network")}"  src="images/network_dark.svg">`);let h="";n&&(h=`<a id="editposition" class="menu-link" data-bind="onUserAdd">${v._("editposition")}</a>`);let c="";this.state.showLatest||(c=`<div id="pright">\n        <img class="icon" alt="${v._("track")}" src="images/stats_blue.svg" style="margin-left: 3em;"><br>\n        <img class="icon" alt="${v._("ttime")}" title="${v._("ttime")}" src="images/time_blue.svg"> ${v.getLocaleDuration(e.totalSeconds)}<br>\n        <img class="icon" alt="${v._("aspeed")}" title="${v._("aspeed")}" src="images/speed_blue.svg"> ${v.getLocaleSpeed(e.totalSpeed,!0)}<br>\n        <img class="icon" alt="${v._("tdistance")}" title="${v._("tdistance")}" src="images/distance_blue.svg"> ${v.getLocaleDistanceMajor(e.totalMeters,!0)}<br>\n        </div>`);const d=`<div id="pheader">\n        <div><img alt="${v._("user")}" title="${v._("user")}" src="images/user_dark.svg"> ${a.htmlEncode(e.username)}</div>\n        <div><img alt="${v._("track")}" title="${v._("track")}" src="images/route_dark.svg"> ${a.htmlEncode(e.trackname)}</div>\n        </div>\n        <div id="pbody">\n        ${e.hasComment()?`<div id="pcomments">${a.htmlEncode(e.comment).replace(/\n/,"<br>")}</div>`:""}\n        ${e.hasImage()?`<div id="pimage"><img src="uploads/${e.image}" alt="image"></div>`:""}\n        <div id="pleft">\n        <img class="icon" alt="${v._("time")}" title="${v._("time")}" src="images/calendar_dark.svg"> ${r}<br>\n        <img class="icon" alt="${v._("time")}" title="${v._("time")}" src="images/clock_dark.svg"> ${o}<br>\n        ${null!==e.speed?`<img class="icon" alt="${v._("speed")}" title="${v._("speed")}" src="images/speed_dark.svg">${v.getLocaleSpeed(e.speed,!0)}<br>`:""}\n        ${null!==e.altitude?`<img class="icon" alt="${v._("altitude")}" title="${v._("altitude")}" src="images/altitude_dark.svg">${v.getLocaleAltitude(e.altitude,!0)}<br>`:""}\n        ${null!==e.accuracy?`<img class="icon" alt="${v._("accuracy")}" title="${v._("accuracy")}" src="images/accuracy_dark.svg">${v.getLocaleAccuracy(e.accuracy,!0)}${l}<br>`:""}\n        ${null!==e.bearing?`<img class="icon" alt="${v._("bearing")}" title="${v._("bearing")}" src="images/bearing.svg" style="transform: rotate(${e.bearing}deg) scale(1.2);">${e.bearing}<br>`:""}\n        <img class="icon" alt="${v._("position")}" title="${v._("position")}" src="images/position.svg">${v.getLocaleCoordinates(e)}<br>\n        </div>${c}</div>\n        <div id="pfooter"><div>${v._("pointof",t+1,s)}</div><div>${h}</div></div>`,u=document.createElement("div");if(u.setAttribute("id","popup"),u.innerHTML=d,e.hasImage()){u.querySelector("#pimage img").onclick=()=>{const t=new St(`<img src="${e.getImagePath()}" alt="image">`);t.element.querySelector("#modal-close").onclick=()=>t.destroy(),t.element.classList.add("image"),t.show()}}if(n){u.querySelector("#editposition").onclick=()=>{new It(this.state,t).init()}}return u}static getMarkerPath(t){return t?"M15,34.911c0,0,0.359-3.922,1.807-8.588c0.414-1.337,1.011-2.587,2.495-4.159c1.152-1.223,3.073-2.393,3.909-4.447c1.681-6.306-3.676-9.258-8.211-9.258c-4.536,0-9.893,2.952-8.211,9.258c0.836,2.055,2.756,3.225,3.91,4.447c1.484,1.572,2.08,2.822,2.495,4.159C14.64,30.989,15,34.911,15,34.911z M18,15.922c0,1.705-1.342,3.087-2.999,3.087c-1.657,0-3-1.382-3-3.087c0-1.704,1.343-3.086,3-3.086C16.658,12.836,18,14.218,18,15.922z":"M14.999,34.911c0,0,0.232-1.275,1.162-4.848c0.268-1.023,0.652-1.98,1.605-3.184c0.742-0.937,1.975-1.832,2.514-3.404c1.082-4.828-2.363-7.088-5.281-7.088c-2.915,0-6.361,2.26-5.278,7.088c0.538,1.572,1.771,2.468,2.514,3.404c0.953,1.203,1.337,2.16,1.604,3.184C14.77,33.635,14.999,34.911,14.999,34.911z"}static getMarkerExtra(t){return`<path fill="none" stroke="red" stroke-width="2" d="${t?"M26.074,13.517":"M23.328,20.715"}c0-3.961-3.243-7.167-7.251-7.167"/>\n            <path fill="none" stroke="red" stroke-width="2" d="${t?"M28.232,10.942":"M25.486,18.141"}c-0.5-4.028-3.642-7.083-7.724-7.542"/>`}static getSvgSrc(t,e,s){const i=`<svg viewBox="0 0 30 35" width="30px" height="35px" xmlns="http://www.w3.org/2000/svg">\n      <g><path stroke="black" fill="${t}" d="${Ot.getMarkerPath(e)}"/>${s?Ot.getMarkerExtra(e):""}</g></svg>`;return`data:image/svg+xml,${encodeURIComponent(i)}`}}class Nt extends bt{constructor(t){super({onTrackDelete:null,onTrackUpdate:null,onCancel:null,trackname:""}),this.track=t.state.currentTrack,this.trackVM=t,this.model.onTrackDelete=()=>this.onTrackDelete(),this.model.onTrackUpdate=()=>this.onTrackUpdate(),this.model.onCancel=()=>this.onCancel()}init(){const t=this.getHtml();this.dialog=new St(t),this.dialog.show(),this.bindAll(this.dialog.element)}getHtml(){return`<div class="red-button button-resolve"><b><a data-bind="onTrackDelete">${v._("deltrack")}</a></b></div>\n      <div>${v._("editingtrack",`<b>${a.htmlEncode(this.track.name)}</b>`)}</div>\n      <div style="clear: both; padding-bottom: 1em;"></div>\n      <form id="trackForm">\n        <label><b>${v._("trackname")}</b></label>\n        <input type="text" placeholder="${v._("trackname")}" name="trackname" data-bind="trackname" value="${a.htmlEncode(this.track.name)}" required autofocus>\n        <div class="buttons">\n          <button class="button-reject" data-bind="onCancel" type="button">${v._("cancel")}</button>\n          <button class="button-resolve" data-bind="onTrackUpdate" type="submit">${v._("submit")}</button>\n        </div>\n      </form>`}onTrackDelete(){St.isConfirmed(v._("trackdelwarn",a.htmlEncode(this.track.name)))&&this.track.delete().then((()=>{this.trackVM.onTrackDeleted(),this.dialog.destroy()})).catch((t=>{Et.error(`${v._("actionfailure")}\n${t.message}`,t)}))}onTrackUpdate(){this.validate()&&(this.track.setName(this.model.trackname),this.track.saveMeta().then((()=>this.dialog.destroy())).catch((t=>{Et.error(`${v._("actionfailure")}\n${t.message}`,t)})))}onCancel(){this.dialog.destroy()}validate(){return this.model.trackname!==this.track.name&&(!!this.model.trackname||(Et.error(v._("allrequired")),!1))}}class Ut extends bt{constructor(t){super({trackList:[],currentTrackId:"",showLatest:!1,autoReload:!1,inputFile:!1,summary:!1,onReload:null,onExportGpx:null,onExportKml:null,onImportGpx:null,onTrackEdit:null}),this.setClickHandlers();const e=document.querySelector("#track");this.importEl=document.querySelector("#input-file"),this.editEl=this.getBoundElement("onTrackEdit"),this.select=new s(e),this.state=t,this.timerId=0}init(){return this.setObservers(),this.bindAll(),this}setObservers(){this.onChanged("trackList",(t=>{this.select.setOptions(t)})),this.onChanged("currentTrackId",(t=>{this.onTrackSelect(t)})),this.onChanged("inputFile",(t=>{t&&this.onImport()})),this.onChanged("autoReload",(t=>{this.autoReload(t)})),this.onChanged("showLatest",(t=>{this.state.showLatest=t,this.onReload(!0)})),this.state.onChanged("currentUser",(t=>{if(t){this.loadTrackList();b.user&&(b.isAdmin||b.user.id===t.id)&&Ut.setMenuVisible(this.editEl,!0)}else this.model.currentTrackId="",this.model.trackList=[],Ut.setMenuVisible(this.editEl,!1)})),this.state.onChanged("currentTrack",(t=>{this.renderSummary(),t&&e.observe(t,"positions",(()=>{this.renderSummary()}))})),this.state.onChanged("showAllUsers",(t=>{t&&this.loadAllUsersPosition()})),y.onChanged("interval",(()=>{this.timerId&&(this.stopAutoReload(),this.startAutoReload())})),this.state.onChanged("history",(t=>{t&&!t.userId&&t.trackId&&(this.model.currentTrackId=t.trackId.toString())}))}setClickHandlers(){this.model.onReload=()=>this.onReload();const t=t=>()=>{this.state.currentTrack&&this.state.currentTrack.export(t)};this.model.onExportGpx=t("gpx"),this.model.onExportKml=t("kml"),this.model.onImportGpx=()=>this.importEl.click(),this.model.onTrackEdit=()=>this.showDialog()}onReload(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.state.showLatest?this.state.showAllUsers?this.loadAllUsersPosition():this.state.currentUser&&this.onUserLastPosition():this.state.currentTrack instanceof l?this.onTrackUpdate(t):this.state.currentTrack instanceof o?this.state.currentTrack=null:this.state.currentUser&&this.loadTrackList()}onImport(){const t=this.importEl.parentElement,e=t.elements.MAX_FILE_SIZE.value;this.importEl.files&&1===this.importEl.files.length&&this.importEl.files[0].size>e?Et.error(v._("isizefailure",e)):b.isAuthenticated?(this.state.jobStart(),l.import(t,b.user).then((t=>{t.length&&(t.length>1&&Et.toast(v._("imultiple",t.length)),this.model.trackList=t.concat(this.model.trackList),this.model.currentTrackId=t[0].listValue)})).catch((t=>Et.error(`${v._("actionfailure")}\n${t.message}`,t))).finally((()=>{this.model.inputFile="",this.state.jobStop()}))):Et.error(v._("notauthorized"))}onTrackSelect(t){const e=this.model.trackList.find((e=>e.listValue===t));e?e.isEqualTo(this.state.currentTrack)||(this.state.jobStart(),e.fetchPositions().then((()=>{e.id,e.length,this.state.currentTrack=e,this.model.showLatest&&(this.model.showLatest=!1)})).catch((t=>{Et.error(`${v._("actionfailure")}\n${t.message}`,t)})).finally((()=>this.state.jobStop()))):this.state.currentTrack=null}onTrackUpdate(t){t&&this.state.currentTrack.clear(),this.state.currentTrack.fetchPositions().catch((t=>{Et.error(`${v._("actionfailure")}\n${t.message}`,t)}))}onUserLastPosition(){this.state.currentUser.fetchLastPosition().then((t=>{t&&(this.model.trackList.find((e=>e.listValue===t.listValue))||this.model.trackList.unshift(t),this.state.currentTrack=t,this.model.currentTrackId=t.listValue)})).catch((t=>{Et.error(`${v._("actionfailure")}\n${t.message}`,t)}))}loadAllUsersPosition(){this.state.jobStart(),o.fetchLatest().then((t=>{t&&(this.model.trackList=[],this.model.currentTrackId="",this.state.currentTrack=t)})).catch((t=>{Et.error(`${v._("actionfailure")}\n${t.message}`,t)})).finally((()=>this.state.jobStop()))}loadTrackList(){this.state.jobStart(),l.fetchList(this.state.currentUser).then((t=>{this.model.trackList=t,t.length?this.state.showLatest?this.onUserLastPosition():this.state.history?this.model.currentTrackId=this.state.history.trackId.toString():this.model.currentTrackId=t[0].listValue:this.model.currentTrackId=""})).catch((t=>{Et.error(`${v._("actionfailure")}\n${t.message}`,t)})).finally((()=>this.state.jobStop()))}showDialog(){new Nt(this).init()}onTrackDeleted(){let t=this.model.trackList.indexOf(this.state.currentTrack);this.state.currentTrack=null,-1!==t&&(this.model.trackList.splice(t,1),this.model.trackList.length?(t>=this.model.trackList.length&&(t=this.model.trackList.length-1),this.model.currentTrackId=this.model.trackList[t].listValue):this.model.currentTrackId="")}autoReload(t){t?this.startAutoReload():this.stopAutoReload()}startAutoReload(){this.timerId=setInterval((()=>this.onReload()),1e3*y.interval)}stopAutoReload(){clearInterval(this.timerId),this.timerId=0}static setMenuVisible(t,e){t&&(e?t.classList.remove("menu-hidden"):t.classList.add("menu-hidden"))}renderSummary(){const t=this.state.currentTrack;if(!t||!t.hasPositions)return void(this.model.summary="");const e=t.positions[t.length-1];if(this.state.showLatest){const t=new Date,s=new Date(1e3*e.timestamp),i=a.getTimeString(s),n=s.toDateString()!==t.toDateString()?`${i.date}<br>`:"",r=`${i.time}<span style="font-weight:normal">${i.zone}</span>`;this.model.summary=`\n        <div class="menu-title">${v._("latest")}:</div>\n        ${n}\n        ${r}`}else{let s=`\n        <div class="menu-title">${v._("summary")}</div>\n        <div><img class="icon" alt="${v._("tdistance")}" title="${v._("tdistance")}" src="images/distance.svg"> ${v.getLocaleDistanceMajor(e.totalMeters,!0)}</div>\n        <div><img class="icon" alt="${v._("ttime")}" title="${v._("ttime")}" src="images/time.svg"> ${v.getLocaleDuration(e.totalSeconds)}</div>`;if(e.totalSeconds>0&&(s+=`\n          <div><img class="icon" alt="${v._("aspeed")}" title="${v._("aspeed")}" src="images/speed.svg"><b>&#10547;</b> ${v.getLocaleSpeed(e.totalMeters/e.totalSeconds,!0)}</div>`),t.hasSpeeds&&(s+=`<div><img class="icon" alt="${v._("speed")}" title="${v._("speed")}" src="images/speed.svg"><b>&#10138;</b> ${v.getLocaleSpeed(t.maxSpeed,!0)}</div>`),t.hasAltitudes){let e=`${v.getLocaleAltitude(t.maxAltitude,!0)}`;t.minAltitude!==t.maxAltitude&&(e=`${v.getLocaleAltitude(t.minAltitude)}&ndash;${e}`),s+=`<div><img class="icon" alt="${v._("altitude")}" title="${v._("altitude")}" src="images/altitude.svg"> ${e}</div>`}this.model.summary=s}}}class Vt extends bt{constructor(t,e){super({onUserDelete:null,onUserUpdate:null,onPassChange:null,onUserAdd:null,onCancel:null,passVisibility:!1,login:null,password:null,password2:null,oldPassword:null,admin:!1}),this.user=t.state.currentUser,this.type=e,this.userVM=t,this.model.onUserDelete=()=>this.onUserDelete(),this.model.onUserUpdate=()=>this.onUserUpdate(),this.model.onPassChange=()=>this.onPassChange(),this.model.onUserAdd=()=>this.onUserAdd(),this.model.onCancel=()=>this.onCancel()}init(){const t=this.getHtml();this.dialog=new St(t),this.dialog.show(),this.bindAll(this.dialog.element);const e=this.getBoundElement("passInput");e&&this.onChanged("passVisibility",(()=>{"none"===e.style.display?e.style.display="block":e.style.display="none"}))}onUserDelete(){St.isConfirmed(v._("userdelwarn",a.htmlEncode(this.user.login)))&&this.user.delete().then((()=>{this.userVM.onUserDeleted(),this.dialog.destroy()})).catch((t=>{Et.error(`${v._("actionfailure")}\n${t.message}`,t)}))}onUserUpdate(){if(this.validate()){const t=this.model.passVisibility?this.model.password:null;this.user.modify(this.model.admin,t).then((()=>this.dialog.destroy())).catch((t=>{Et.error(`${v._("actionfailure")}\n${t.message}`,t)}))}}onPassChange(){this.model.passVisibility=!0,this.validate()&&b.user.setPassword(this.model.password,this.model.oldPassword).then((()=>this.dialog.destroy())).catch((t=>{Et.error(`${v._("actionfailure")}\n${t.message}`,t)}))}onUserAdd(){this.model.passVisibility=!0,this.validate()&&h.add(this.model.login,this.model.password,this.model.admin).then((t=>{this.userVM.onUserAdded(t),this.dialog.destroy()})).catch((t=>{Et.error(`${v._("actionfailure")}\n${t.message}`,t)}))}onCancel(){this.dialog.destroy()}validate(){if("add"===this.type){if(!this.model.login)return Et.error(v._("allrequired")),!1}else if("pass"===this.type&&!this.model.oldPassword)return Et.error(v._("allrequired")),!1;if(this.model.passVisibility){if(!this.model.password||!this.model.password2)return Et.error(v._("allrequired")),!1;if(this.model.password!==this.model.password2)return Et.error(v._("passnotmatch")),!1;if(!y.validPassStrength(this.model.password))return Et.error(v.getLocalePassRules()),!1}return!0}getHtml(){let t,e,s="",i="";switch(this.type){case"add":t="onUserAdd",i=`<label><b>${v._("username")}</b></label>\n        <input type="text" placeholder="${v._("usernameenter")}" name="login" data-bind="login" required autofocus>`,e=`<label><b>${v._("password")}</b></label>\n        <input type="password" placeholder="${v._("passwordenter")}" name="password" data-bind="password" required>\n        <label><b>${v._("passwordrepeat")}</b></label>\n        <input type="password" placeholder="${v._("passwordenter")}" name="password2" data-bind="password2" required>\n        <label><b>${v._("admin")}</b></label>\n        <input type="checkbox" name="admin" data-bind="admin">`;break;case"edit":t="onUserUpdate",s=`<div class="red-button button-resolve"><b><a data-bind="onUserDelete">${v._("deluser")}</a></b></div>\n        <div>${v._("editinguser",`<b>${a.htmlEncode(this.user.login)}</b>`)}</div>\n        <div style="clear: both; padding-bottom: 1em;"></div>`,e=`<label><b>${v._("changepass")}</b></label>\n        <input type="checkbox" name="changepass" data-bind="passVisibility"><br>\n        <div style="display: none;" data-bind="passInput">\n          <label><b>${v._("password")}</b></label>\n          <input type="password" placeholder="${v._("passwordenter")}" name="password" data-bind="password" required autofocus>\n          <label><b>${v._("passwordrepeat")}</b></label>\n          <input type="password" placeholder="${v._("passwordenter")}" name="password2" data-bind="password2" required>\n        </div>\n        <label><b>${v._("admin")}</b></label>\n        <input type="checkbox" name="admin" data-bind="admin" ${this.user.isAdmin?"checked":""}>`;break;case"pass":t="onPassChange",e=`<label><b>${v._("oldpassword")}</b></label>\n        <input type="password" placeholder="${v._("passwordenter")}" name="old-password" data-bind="oldPassword" required autofocus>\n        <label><b>${v._("newpassword")}</b></label>\n        <input type="password" placeholder="${v._("passwordenter")}" name="password" data-bind="password" required>\n        <label><b>${v._("newpasswordrepeat")}</b></label>\n        <input type="password" placeholder="${v._("passwordenter")}" name="password2" data-bind="password2" required>`;break;default:throw new Error(`Unknown dialog type: ${this.type}`)}return`${s}\n      <form id="userForm">\n        ${i}\n        ${e}\n        <div class="buttons">\n          <button class="button-reject" type="button" data-bind="onCancel">${v._("cancel")}</button>\n          <button class="button-resolve" type="submit" data-bind="${t}">${v._("submit")}</button>\n        </div>\n      </form>`}}class Bt extends bt{constructor(t){super({userList:[],currentUserId:"0",onUserEdit:null,onUserAdd:null,onPasswordChange:null}),this.setClickHandlers();const e=document.querySelector("#user");this.editEl=this.getBoundElement("onUserEdit"),this.select=new s(e,v._("suser"),`- ${v._("allusers")} -`),this.state=t}setClickHandlers(){this.model.onUserEdit=()=>this.showDialog("edit"),this.model.onUserAdd=()=>this.showDialog("add"),this.model.onPasswordChange=()=>this.showDialog("pass")}init(){return this.setObservers(this.state),this.bindAll(),h.fetchList().then((t=>{if(this.model.userList=t,t.length){let e=t[0].listValue;if(this.state.history)e=this.state.history.userId.toString();else if(b.isAuthenticated){const t=this.model.userList.find((t=>t.listValue===b.user.listValue));t&&(e=t.listValue)}this.model.currentUserId=e}})).catch((t=>{Et.error(`${v._("actionfailure")}\n${t.message}`,t)})),this}setObservers(t){this.onChanged("userList",(t=>{this.select.setOptions(t)})),this.onChanged("currentUserId",(t=>{this.state.showAllUsers=t===s.allValue,this.state.currentUser=this.model.userList.find((e=>e.listValue===t))||null,Bt.setMenuVisible(this.editEl,null!==this.state.currentUser&&!this.state.currentUser.isEqualTo(b.user))})),t.onChanged("showLatest",(t=>{t?this.select.showAllOption():this.select.hideAllOption()})),t.onChanged("history",(t=>{t&&t.userId&&(this.model.currentUserId=t.userId.toString())}))}showDialog(t){new Vt(this,t).init()}onUserAdded(t){this.model.userList.push(t),this.model.userList.sort(((t,e)=>t.login>e.login?1:-1))}onUserDeleted(){let t=this.model.userList.indexOf(this.state.currentUser);this.state.currentUser=null,-1!==t&&(this.model.userList.splice(t,1),this.model.userList.length?(t>=this.model.userList.length&&(t=this.model.userList.length-1),this.model.currentUserId=this.model.userList[t].listValue):this.model.currentUserId="0")}static setMenuVisible(t,e){t&&(e?t.classList.remove("menu-hidden"):t.classList.add("menu-hidden"))}}class jt{constructor(t){this.state=t,this.skipPush=!1}init(){return this.state.onChanged("mapParams",(()=>this.pushState())),window.addEventListener("popstate",(t=>{if(null===t.state)return;const e=this.state.currentTrack,s=this.state.currentUser,i={title:t.state.title,userId:s&&s.id===t.state.userId?null:t.state.userId,trackId:e&&e.id===t.state.trackId?null:t.state.trackId,mapApi:y.mapApi===t.state.mapApi?null:t.state.mapApi,mapParams:t.state.mapParams};this.onPop(i),this.skipPush=!0})),this}static parseHash(){return jt.parse(window.location.hash)}static parse(t){const e=t.replace("#","").split("/");e.reverse();const s=parseInt(e.pop());if(!isNaN(s)){let t="openlayers";"g"===e.pop()&&(t="gmaps");let i=null;return e.length>=4&&(i={},i.center=[parseFloat(e.pop()),parseFloat(e.pop())],i.zoom=parseFloat(e.pop()),i.rotation=parseFloat(e.pop())),l.getMeta(s).then((e=>{const n=e.userId;return{title:e.name,userId:n,trackId:s,mapApi:t,mapParams:i}})).catch((t=>null))}return Promise.resolve(null)}onPop(t){t&&(t.trackId,t.mapApi,t.mapParams),this.state.history=t,t&&(document.title=`${v._("title")} ${t.title}`)}pushState(){if(this.skipPush)return void(this.skipPush=!1);if(null===this.state.currentUser||null===this.state.currentTrack)return;const t=this.getState(),e=window.history.state;if(!e||!a.isDeepEqual(e,t)){const e=jt.getHash(t);window.history.pushState(t,t.title,e),document.title=`${v._("title")} ${t.title}`}}getState(){return{title:this.state.currentTrack.name,userId:this.state.currentUser.id,trackId:this.state.currentTrack.id,mapApi:y.mapApi,mapParams:this.state.mapParams}}static getHash(t){let e=`#${t.trackId}/${t.mapApi.charAt(0)}`;return t.mapParams&&(e+=`/${t.mapParams.center[0]}/${t.mapParams.center[1]}`,e+=`/${t.mapParams.zoom}/${t.mapParams.rotation}`),e}}class Dt{constructor(t){this.spinner=null,this.state=t}init(){this.state.onChanged("activeJobs",(t=>{t>0?this.spinner||(this.spinner=Et.spinner()):this.spinner&&(this.spinner.destroy(),this.spinner=null)}))}}class zt{constructor(){this.currentTrack=null,this.currentUser=null,this.showLatest=!1,this.showAllUsers=!1,this.activeJobs=0,this.mapParams=null,this.history=null}jobStart(){this.activeJobs++}jobStop(){this.activeJobs--}onChanged(t,s){e.observe(this,t,s)}}const Rt=g.waitForDom(),Ht=f.initialize(),qt=jt.parseHash();Promise.all([Rt,Ht,qt]).then((t=>{!function(t){const e=new zt,s=new jt(e),i=new Dt(e),n=new Mt(e),a=new Bt(e),r=new Ut(e),o=new Ot(e),l=new kt(e),h=new At(e);s.init().onPop(t),i.init(),n.init(),a.init(),r.init(),o.init().loadMapAPI(y.mapApi),l.init(),h.init(),o.onChanged("markerOver",(t=>{null!==t?l.onPointOver(t):l.onPointOut()})),o.onChanged("markerSelect",(t=>{null!==t?l.onPointSelect(t):l.onPointUnselect()})),l.onChanged("pointSelected",(t=>{null!==t&&o.api.animateMarker(t)}))}(t[2])})).catch((t=>Et.error(`${v._("actionfailure")}\n${t}`)))}()}();
//# sourceMappingURL=bundle.js.map